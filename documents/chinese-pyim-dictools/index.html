<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>chinese-pyim-dictools - Chinese-pyim</title>
    <meta charset="utf-8" />
    <meta name="author" content="Feng Shu" />
    <link rel="stylesheet" href="https://tumashu.github.io/chinese-pyim/media/css/main.css" type="text/css">
  </head>
<body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="https://tumashu.github.io/chinese-pyim/">Chinese-pyim</a> <span class="subtitle">(一个 emacs 环境下的中文拼音输入法)</span></h1>
        <ul>
          <li><a href="https://tumashu.github.io/chinese-pyim/documents/">Documents</a></li>
          <li><a href="https://tumashu.github.io/chinese-pyim/snapshots/">Snapshots</a></li>
          <li><a href="https://tumashu.github.io/chinese-pyim/tags/">Tags</a></li>
          <li><a href="https://tumashu.github.io/chinese-pyim/about/">About</a></li>
          <li><a href="https://github.com/tumashu/chinese-pyim">GitHub</a></li>
          <li><a href="https://tumashu.github.io/chinese-pyim/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="tumashu.github.io/chinese-pyim">
        </form>
        <img class="avatar" src="https://tumashu.github.io/chinese-pyim/media/img/horse.jpg" />
      </header>
    </div>

<div class="content-and-footer">
<div>
<div class="post">
<h1 class="post-title">chinese-pyim-dictools</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org21c8f7a">1. 说明文档&#xa0;&#xa0;&#xa0;<span class="tag"><span class="doc">doc</span></span></a></li>
<li><a href="#org4a50d16">2. 代码&#xa0;&#xa0;&#xa0;<span class="tag"><span class="code">code</span></span></a>
<ul>
<li><a href="#orgb14c011">2.1. Require</a></li>
<li><a href="#org42067d7">2.2. 汉字到拼音的转换工具</a></li>
<li><a href="#org879ca40">2.3. Chinese-pyim 词库管理工具</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org21c8f7a" class="outline-2">
<h2 id="org21c8f7a"><span class="section-number-2">1</span>说明文档&#xa0;&#xa0;&#xa0;<span class="tag"><span class="doc">doc</span></span></h2>
<div class="outline-text-2" id="text-1">
<p>
这个文件主要包含与词库文件管理相关的一些命令和函数，比如：
</p>
<ol class="org-ol">
<li>词库管理器</li>
<li>汉字转拼音</li>
<li>其它</li>
</ol>
</div>
</div>




<div id="outline-container-org4a50d16" class="outline-2">
<h2 id="org4a50d16"><span class="section-number-2">2</span>代码&#xa0;&#xa0;&#xa0;<span class="tag"><span class="code">code</span></span></h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgb14c011" class="outline-3">
<h3 id="orgb14c011"><span class="section-number-3">2.1</span> Require</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">cl-lib</span>)
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-pymap</span>)
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-core</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org42067d7" class="outline-3">
<h3 id="org42067d7"><span class="section-number-3">2.2</span>汉字到拼音的转换工具</h3>
<div class="outline-text-3" id="text-2-2">
<p>
`pyim-hanzi2pinyin' 和 `pyim-hanzi2pinyin-simple' 可以将一个中文字符串转换为拼音字符串或者拼音列表，也可以将一个中文字符串转换为拼音首字母字符串或者首字母列表。
</p>

<p>
在转换的过程中，`pyim-hanzi2pinyin' 考虑多音字，所以适用于制作词库，Chinese-pyim 使用这个函数来制作词库。而 `pyim-hanzi2pinyin-simple' 不考虑多音字，可以用于添加拼音索引。
</p>

<p>
例如：
</p>
<pre class="example">
(list (pyim-hanzi2pinyin "银行")
      (pyim-hanzi2pinyin "银行" t)
      (pyim-hanzi2pinyin "银行" nil "-")
      (pyim-hanzi2pinyin "银行" nil "-" t)
      (pyim-hanzi2pinyin "银行" t "-" t))
</pre>

<p>
RESULTS:
</p>
<pre class="example">
("yinhang yinxing" "yh yx" "yin-hang yin-xing" ("yin-hang" "yin-xing") ("y-h" "y-x"))
</pre>

<pre class="example">
(list (pyim-hanzi2pinyin-simple "行长")
      (pyim-hanzi2pinyin-simple "行长" t)
      (pyim-hanzi2pinyin-simple "行长" nil "-")
      (pyim-hanzi2pinyin-simple "行长" nil "-" t)
      (pyim-hanzi2pinyin-simple "行长" t "-" t))
</pre>

<p>
RESULTS:
</p>
<pre class="example">
("hangchang" "hc" "hang-chang" ("hang-chang") ("h-c"))
</pre>

<p>
`pyim-hanzi2pinyin' 函数使用 “排列组合” 函数 `pyim-permutate-list' 来处理多音字，这个函数所做工作类似：
</p>

<pre class="example">
(cl-prettyprint
 (pyim-permutate-list
  '(("a" "b")
    ("c" "d")
    ("e" "f" "g"))))

OUTPUT:

(("a" "c" "e")
 ("a" "c" "f")
 ("a" "c" "g")
 ("a" "d" "e")
 ("a" "d" "f")
 ("a" "d" "g")
 ("b" "c" "e")
 ("b" "c" "f")
 ("b" "c" "g")
 ("b" "d" "e")
 ("b" "d" "f")
 ("b" "d" "g"))
</pre>



<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-hanzi2pinyin</span> (string <span style="color: #afd8af;">&amp;optional</span> shou-zi-mu separator
                                 return-list ignore-duo-yin-zi adjuct-duo-yin-zi)
  <span style="color: #FBDE2D;">"&#23558;&#27721;&#23383;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026;&#23545;&#24212;&#30340;&#25340;&#38899;&#23383;&#31526;&#20018;, &#22914;&#26524; `</span><span style="color: #96CBFE;">shou-zi-mu</span><span style="color: #FBDE2D;">' &#35774;&#32622;&#20026;t,&#36716;&#25442;&#20165;&#24471;&#21040;&#25340;&#38899;</span>
<span style="color: #FBDE2D;">&#39318;&#23383;&#27597;&#23383;&#31526;&#20018;&#12290;&#24403; `</span><span style="color: #96CBFE;">return-list</span><span style="color: #FBDE2D;">' &#35774;&#32622;&#20026; t &#26102;&#65292;&#36820;&#22238;&#19968;&#20010;&#25340;&#38899;&#21015;&#34920;&#65292;&#36825;&#20010;&#21015;&#34920;&#21253;&#21547;&#35789;&#26465;&#30340;&#19968;&#20010;</span>
<span style="color: #FBDE2D;">&#25110;&#32773;&#22810;&#20010;&#25340;&#38899;&#65288;&#35789;&#26465;&#21253;&#21547;&#22810;&#38899;&#23383;&#26102;&#65289;&#65307;&#22914;&#26524; `</span><span style="color: #96CBFE;">ignore-duo-yin-zi</span><span style="color: #FBDE2D;">' &#35774;&#32622;&#20026;t, &#36935;&#21040;&#22810;&#38899;&#23383;&#26102;&#65292;</span>
<span style="color: #FBDE2D;">&#21482;&#20351;&#29992;&#31532;&#19968;&#20010;&#25340;&#38899;&#65292;&#20854;&#23427;&#25340;&#38899;&#24573;&#30053;&#65307;&#24403; `</span><span style="color: #96CBFE;">adjuct-duo-yin-zi</span><span style="color: #FBDE2D;">' &#35774;&#32622;&#20026;t&#26102;&#65292;pyim-hanzi2pinyin</span>
<span style="color: #FBDE2D;">&#20250;&#20351;&#29992; Chinese-pyim &#24050;&#23433;&#35013;&#30340;&#35789;&#24211;&#26469;&#26657;&#27491;&#22810;&#38899;&#23383;&#65292;&#20294;&#36825;&#20010;&#21151;&#33021;&#26377;&#19968;&#23450;&#30340;&#38480;&#21046;:</span>

<span style="color: #FBDE2D;">1. Chinese-pyim &#26222;&#36890;&#35789;&#24211;&#20013;&#19981;&#23384;&#22312;&#30340;&#35789;&#26465;&#19981;&#33021;&#36739;&#27491;</span>
<span style="color: #FBDE2D;">2. &#22810;&#38899;&#23383;&#26657;&#27491;&#36895;&#24230;&#27604;&#36739;&#24930;&#65292;&#23454;&#26102;&#36716;&#25442;&#20250;&#20135;&#29983;&#21345;&#39039;&#12290;</span>

<span style="color: #FBDE2D;">BUG: &#24403; `</span><span style="color: #96CBFE;">string</span><span style="color: #FBDE2D;">' &#20013;&#21253;&#21547;&#20854;&#23427;&#26631;&#28857;&#31526;&#21495;&#65292;&#24182;&#19988;&#35774;&#32622; `</span><span style="color: #96CBFE;">separator</span><span style="color: #FBDE2D;">' &#26102;&#65292;&#32467;&#26524;&#20250;&#21253;&#21547;&#22810;&#20313;&#30340;&#36830;&#25509;&#31526;&#65306;</span>
<span style="color: #FBDE2D;">&#27604;&#22914;&#65306; '&#20320;=&#22909;' --&gt; 'ni-=-hao'"</span>
  (<span style="color: #4c83ff;">if</span> (not (pyim-string-match-p <span style="color: #61CE3C;">"\\cc"</span> string))
      (<span style="color: #4c83ff;">if</span> return-list
          (list string)
        string)
    (<span style="color: #4c83ff;">let</span> (string-list pinyins-list pinyins-list-permutated pinyins-list-adjusted)

      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#23558;&#27721;&#23383;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026;&#23383;&#31526;list&#65292;&#33521;&#25991;&#21407;&#26679;&#36755;&#20986;&#12290;</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#27604;&#22914;&#65306; &#8220;Hello&#38134;&#34892;&#8221; -&gt; ("Hello" "&#38134;" "&#34892;")</span>
      (<span style="color: #4c83ff;">setq</span> string-list
            (<span style="color: #4c83ff;">if</span> (pyim-string-match-p <span style="color: #61CE3C;">"\\CC"</span> string)
                <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#22788;&#29702;&#20013;&#33521;&#25991;&#28151;&#21512;&#30340;&#24773;&#20917;</span>
                (split-string
                 (replace-regexp-in-string
                  <span style="color: #61CE3C;">"</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">(</span><span style="color: #61CE3C;">\\cc</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">)</span><span style="color: #61CE3C;">"</span> <span style="color: #61CE3C;">"@@@@\\1@@@@"</span> string)
                 <span style="color: #61CE3C;">"@@@@"</span>)
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#22914;&#26524;&#35789;&#26465;&#21482;&#21253;&#21547;&#20013;&#25991;&#65292;&#20351;&#29992;`</span><span style="color: #96CBFE; font-style: italic;">string-to-vector</span><span style="color: #8B8989; font-style: italic;">'</span>
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#36825;&#26679;&#22788;&#29702;&#36895;&#24230;&#27604;&#36739;&#24555;&#12290;</span>
              (string-to-vector string)))

      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#23558;&#19978;&#36848;&#27721;&#23383;&#23383;&#31526;&#20018;&#37324;&#38754;&#30340;&#25152;&#26377;&#27721;&#23383;&#36716;&#25442;&#20026;&#19982;&#20043;&#23545;&#24212;&#30340;&#25340;&#38899;list&#12290;</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#27604;&#22914;&#65306; ("Hello" "&#38134;" "&#34892;") -&gt; (("Hello") ("yin") ("hang" "xing"))</span>
      (mapc
       #'(lambda (str)
           <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">`</span><span style="color: #96CBFE; font-style: italic;">string-to-vector</span><span style="color: #8B8989; font-style: italic;">' &#24471;&#21040;&#30340;&#26159; char vector, &#38656;&#35201;&#23558;&#20854;&#36716;&#25442;&#20026; string&#12290;</span>
           (<span style="color: #4c83ff;">when</span> (numberp str)
             (<span style="color: #4c83ff;">setq</span> str (char-to-string str)))
           (<span style="color: #4c83ff;">cond</span>
            ((&gt; (length str) 1)
             (<span style="color: #4c83ff;">push</span> (list str) pinyins-list))
            ((<span style="color: #4c83ff;">and</span> (&gt; (length str) 0)
                  (pyim-string-match-p <span style="color: #61CE3C;">"\\cc"</span> str))
             (<span style="color: #4c83ff;">push</span> (<span style="color: #4c83ff;">or</span> (pyim-cchar2pinyin-get (string-to-char str))
                       (list str))
                   pinyins-list))
            ((&gt; (length str) 0)
             (<span style="color: #4c83ff;">push</span> (list str) pinyins-list))))
       string-list)
      (<span style="color: #4c83ff;">setq</span> pinyins-list (nreverse pinyins-list))

      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#36890;&#36807;&#25490;&#21015;&#32452;&#21512;&#30340;&#26041;&#24335;, &#37325;&#25490; pinyins-list&#12290;</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#27604;&#22914;&#65306;(("Hello") ("yin") ("hang" "xing")) -&gt; (("Hello" "yin" "hang") ("Hello" "yin" "xing"))</span>
      (<span style="color: #4c83ff;">setq</span> pinyins-list-permutated (pyim-permutate-list2 pinyins-list))

      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#20351;&#29992; Chinese-pyim &#30340;&#23433;&#35013;&#30340;&#35789;&#24211;&#26469;&#26657;&#27491;&#22810;&#38899;&#23383;&#12290;</span>
      (<span style="color: #4c83ff;">when</span> adjuct-duo-yin-zi
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#30830;&#20445; pyim &#35789;&#24211;&#21152;&#36733;</span>
        (pyim-dcache-init-variables)
        (<span style="color: #4c83ff;">dolist</span> (pinyin-list pinyins-list-permutated)
          (<span style="color: #4c83ff;">let*</span> ((py-str (mapconcat #'identity pinyin-list <span style="color: #61CE3C;">"-"</span>))
                 (words-from-dicts
                  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">pyim-buffer-list &#20013;&#31532;&#19968;&#20010; buffer &#23545;&#24212;&#30340;&#26159;&#20010;&#20154;&#35789;&#24211;&#25991;&#20214;</span>
                  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#20010;&#20154;&#35789;&#24211;&#25991;&#20214;&#20013;&#30340;&#35789;&#26465;&#65292;&#26497;&#26377;&#21487;&#33021;&#23384;&#22312; *&#22810;&#38899;&#23383;&#27745;&#26579;*&#12290;</span>
                  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#36825;&#26159;&#30001; Chinese-pyim &#20445;&#23384;&#35789;&#26465;&#30340;&#26426;&#21046;&#20915;&#23450;&#30340;&#12290;</span>
                  (pyim-dcache-get py-str pyim-dcache-code2word)))
            (<span style="color: #4c83ff;">when</span> (member string words-from-dicts)
              (<span style="color: #4c83ff;">push</span> pinyin-list pinyins-list-adjusted))))
        (<span style="color: #4c83ff;">setq</span> pinyins-list-adjusted
              (nreverse pinyins-list-adjusted)))

      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#36820;&#22238;&#25340;&#38899;&#23383;&#31526;&#20018;&#25110;&#32773;&#25340;&#38899;&#21015;&#34920;</span>
      (<span style="color: #4c83ff;">let*</span> ((pinyins-list
              (<span style="color: #4c83ff;">or</span> pinyins-list-adjusted
                  pinyins-list-permutated))
             (list (mapcar
                    #'(lambda (x)
                        (mapconcat
                         #'(lambda (str)
                             (<span style="color: #4c83ff;">if</span> shou-zi-mu
                                 (substring str 0 1)
                               str))
                         x separator))
                    (<span style="color: #4c83ff;">if</span> ignore-duo-yin-zi
                        (list (car pinyins-list))
                      pinyins-list))))
        (<span style="color: #4c83ff;">if</span> return-list
            list
          (mapconcat #'identity list <span style="color: #61CE3C;">" "</span>))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-permutate-list</span> (list)
  <span style="color: #FBDE2D;">"&#20351;&#29992;&#25490;&#21015;&#32452;&#21512;&#30340;&#26041;&#24335;&#37325;&#26032;&#25490;&#21015; `</span><span style="color: #96CBFE;">list</span><span style="color: #FBDE2D;">'&#65292;&#36825;&#20010;&#20989;&#25968;&#30001; &#8216;</span><span style="color: #96CBFE;">&#20108;&#20013;</span><span style="color: #FBDE2D;">&#8217; &#25552;&#20379;&#12290;</span>
<span style="color: #FBDE2D;">&#27880;&#65306;`</span><span style="color: #96CBFE;">pyim-hanzi2pinyin</span><span style="color: #FBDE2D;">' &#27809;&#26377;&#20351;&#29992;&#36825;&#20010;&#20989;&#25968;(&#36895;&#24230;&#31245;&#24494;&#26377;&#28857;&#24930;)&#12290;"</span>
  (<span style="color: #4c83ff;">let</span> ((list-head (car list))
        (list-tail (cdr list)))
    (<span style="color: #4c83ff;">cond</span> ((null list-tail)
           (<span style="color: #4c83ff;">cl-loop</span> for element0 in list-head
                    append (cons (cons element0 nil) nil)))
          (t (<span style="color: #4c83ff;">cl-loop</span> for element in list-head
                      append (mapcar (<span style="color: #4c83ff;">lambda</span> (l) (cons element l))
                                     (pyim-permutate-list list-tail)))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-permutate-list2</span> (list)
  <span style="color: #FBDE2D;">"&#20351;&#29992;&#25490;&#21015;&#32452;&#21512;&#30340;&#26041;&#24335;&#37325;&#26032;&#25490;&#21015; `</span><span style="color: #96CBFE;">list</span><span style="color: #FBDE2D;">'&#65292;&#36825;&#20010;&#20989;&#25968;&#30001; &#8217;&#32704;/ty&#8216; &#25552;&#20379;&#12290;</span>
<span style="color: #FBDE2D;">`</span><span style="color: #96CBFE;">pyim-hanzi2pinyin</span><span style="color: #FBDE2D;">' &#40664;&#35748;&#20351;&#29992;&#36825;&#20010;&#20989;&#25968;&#12290;"</span>
  (<span style="color: #4c83ff;">if</span> (= (length list) 1)
      (mapcar #'list (car list))
    (pyim-permutate-list2-internal (car list) (cdr list))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-permutate-list2-internal</span> (one two)
  <span style="color: #FBDE2D;">"`</span><span style="color: #96CBFE;">pyim-permutate-list2</span><span style="color: #FBDE2D;">' &#30340;&#20869;&#37096;&#20989;&#25968;&#12290;"</span>
  (<span style="color: #4c83ff;">let</span> (<span style="color: #4c83ff;">return</span>)
    (<span style="color: #4c83ff;">if</span> (null (car two))
        one
      (<span style="color: #4c83ff;">dolist</span> (x1 one)
        (<span style="color: #4c83ff;">dolist</span> (x2 (car two))
          (<span style="color: #4c83ff;">push</span> (<span style="color: #4c83ff;">if</span> (listp x1)
                    (append x1 (list x2))
                  (list x1 x2))
                return)))
      (<span style="color: #4c83ff;">setq</span> one return)
      (pyim-permutate-list2-internal one (cdr two)))))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-hanzi2pinyin-simple</span> (string <span style="color: #afd8af;">&amp;optional</span> shou-zi-mu separator return-list)
  <span style="color: #FBDE2D;">"&#31616;&#21270;&#29256;&#30340; `</span><span style="color: #96CBFE;">pyim-hanzi2pinyin</span><span style="color: #FBDE2D;">', &#19981;&#22788;&#29702;&#22810;&#38899;&#23383;&#12290;"</span>
  (pyim-hanzi2pinyin string shou-zi-mu separator return-list t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org879ca40" class="outline-3">
<h3 id="org879ca40"><span class="section-number-3">2.3</span> Chinese-pyim 词库管理工具</h3>
<div class="outline-text-3" id="text-2-3">
<p>
为 Chinese-pyim 添加一个简单的词库管理工具 `pyim-dicts-manager' ，可以方便的执行下列命令：
</p>
<ol class="org-ol">
<li>添加词库。</li>
<li>删除词库。</li>
<li>向上和向下移动词库。</li>
<li>保存词库设置。</li>
<li>重启输入法。</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defvar</span> <span style="color: #ff69b4;">pyim-dm-buffer</span> <span style="color: #61CE3C;">"*pyim-dict-manager*"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-refresh</span> ()
  <span style="color: #FBDE2D;">"Refresh the contents of the *pyim-dict-manager* buffer."</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">with-current-buffer</span> pyim-dm-buffer
    (<span style="color: #4c83ff;">let</span> ((inhibit-read-only t)
          (dicts-list pyim-dicts)
          (format-string <span style="color: #61CE3C;">"%-4s %-4s %-60s\n"</span>)
          (face-attr '((foreground-color . <span style="color: #61CE3C;">"DarkOrange2"</span>)
                       (bold . t)))
          (i 1))
      (erase-buffer)
      (insert (propertize (format format-string <span style="color: #61CE3C;">"&#24207;&#21495;"</span> <span style="color: #61CE3C;">"&#21551;&#29992;"</span> <span style="color: #61CE3C;">"&#35789;&#24211;&#25991;&#20214;"</span>)
                          'face face-attr))
      (insert (propertize (format format-string
                                  <span style="color: #61CE3C;">"----"</span> <span style="color: #61CE3C;">"----"</span>
                                  <span style="color: #61CE3C;">"----------------------------------------------------------------------\n"</span>)
                          'face face-attr))
      (<span style="color: #4c83ff;">if</span> (not pyim-dicts)
          (insert <span style="color: #61CE3C;">"&#25340;&#38899;&#35789;&#24211;&#26159; Chinese-pyim &#20351;&#29992;&#39034;&#25163;&#19982;&#21542;&#30340;&#20851;&#38190;&#12290;&#26681;&#25454;&#32463;&#39564;&#20272;&#35745;&#65306;</span>

<span style="color: #61CE3C;">1. &#24403;&#35789;&#24211;&#35789;&#26465;&#36229;&#36807;100&#19975;&#26102; (&#35789;&#24211;&#25991;&#20214;&gt;20M)&#65292;Chinese-pyim &#36873;&#35789;&#39057;&#29575;&#22823;&#22823;&#38477;&#20302;&#12290;</span>
<span style="color: #61CE3C;">2. &#24403;&#35789;&#24211;&#35789;&#26465;&#36229;&#36807;100&#19975;&#26102;&#65292;Chinese-pyim &#20013;&#25991;&#36755;&#20837;&#20307;&#39564;&#21487;&#20197;&#36798;&#21040;&#25628;&#29399;&#36755;&#20837;&#27861;&#30340; 80%&#12290;</span>

<span style="color: #61CE3C;">&#24819;&#24555;&#36895;&#20307;&#39564; Chinese-pyim &#36755;&#20837;&#27861;&#30340;&#29992;&#25143;, &#21487;&#20197;&#20351;&#29992; chinese-pyim-basedict&#65306;</span>

<span style="color: #61CE3C;">     (require 'chinese-pyim-basedict)</span>
<span style="color: #61CE3C;">     (chinese-pyim-basedict-enable)</span>

<span style="color: #61CE3C;">&#22914;&#26524;&#29992;&#25143;&#30340;&#35745;&#31639;&#26426;&#24615;&#33021;&#27604;&#36739;&#22909;&#65292;&#24314;&#35758;&#20174; Melpa &#23433;&#35013; chinese-pyim-greatdict &#21253;,</span>
<span style="color: #61CE3C;">&#36825;&#20010;&#35789;&#24211;&#21253;&#26377; 300 &#22810;&#19975;&#35789;&#26465;&#65292;&#26159;&#19968;&#20010; *&#22823;&#32780;&#20840;* &#30340;&#35789;&#24211;&#12290;</span>

<span style="color: #61CE3C;">&#21916;&#27426;&#25240;&#33150;&#30340;&#29992;&#25143;&#21487;&#20197;&#20174;&#19979;&#38754;&#20960;&#20010;&#36884;&#24452;&#33719;&#24471; Chinese-pyim &#26356;&#35814;&#32454;&#30340;&#20449;&#24687;&#12290;</span>
<span style="color: #61CE3C;">1. &#20351;&#29992; `C-h v pyim-dicts' &#20102;&#35299; `</span><span style="color: #96CBFE;">Chinese-pyim</span><span style="color: #61CE3C;">' &#35789;&#24211;&#25991;&#20214;&#26684;&#24335;&#12290;</span>
<span style="color: #61CE3C;">2. &#20102;&#35299;&#22914;&#20309;&#23548;&#20837;&#20854;&#23427;&#36755;&#20837;&#27861;&#30340;&#35789;&#24211;&#12290;</span>
<span style="color: #61CE3C;">   1. &#20351;&#29992; package &#31649;&#29702;&#22120;&#26597;&#30475; Chinese-pyim &#21253;&#30340;&#31616;&#20171;</span>
<span style="color: #61CE3C;">   2. &#38405;&#35835; chinese-pyim.el &#25991;&#20214; Commentary</span>
<span style="color: #61CE3C;">   3. &#26597;&#30475; Chinese-pyim &#22312;&#32447; README&#65306;https://github.com/tumashu/chinese-pyim\n"</span>)
        (<span style="color: #4c83ff;">dolist</span> (dict dicts-list)
          (<span style="color: #4c83ff;">let</span> ((disable (plist-get dict <span style="color: #4c83ff;">:disable</span>))
                (file (plist-get dict <span style="color: #4c83ff;">:file</span>)))
            (insert (propertize (format format-string
                                        i (<span style="color: #4c83ff;">if</span> disable <span style="color: #61CE3C;">"NO"</span> <span style="color: #61CE3C;">"YES"</span>) file)
                                'id i 'disable disable 'file file)))
          (<span style="color: #4c83ff;">setq</span> i (1+ i))))
      (insert (propertize <span style="color: #61CE3C;">"</span>
<span style="color: #61CE3C;">&#25805;&#20316;&#21629;&#20196;&#65306;[A] &#28155;&#21152;&#35789;&#24211;  [D] &#21024;&#38500;&#35789;&#24211;   [P] &#21521;&#19978;&#31227;&#21160;   [N] &#21521;&#19979;&#31227;&#21160;  [g] &#21047;&#26032;&#39029;&#38754;</span>
<span style="color: #61CE3C;">          [s] &#20445;&#23384;&#37197;&#32622;  [R] &#37325;&#21551;&#36755;&#20837;&#27861; [C-c C-c] &#31105;&#29992;/&#21551;&#29992;&#24403;&#21069;&#35789;&#24211;"</span>
                          'face face-attr)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-toggle-dict</span> (<span style="color: #afd8af;">&amp;optional</span> enable)
  <span style="color: #FBDE2D;">"&#21551;&#29992;&#24403;&#21069;&#34892;&#23545;&#24212;&#30340;&#35789;&#24211;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">when</span> (equal (buffer-name) pyim-dm-buffer)
    (<span style="color: #4c83ff;">let*</span> ((id (get-text-property (point) 'id))
           (disable (get-text-property (point) 'disable))
           (dict (cl-copy-list (nth (1- id) pyim-dicts)))
           (disable (plist-get dict <span style="color: #4c83ff;">:disable</span>))
           (line (line-number-at-pos)))
      (<span style="color: #4c83ff;">setf</span> (nth (1- id) pyim-dicts) (plist-put dict <span style="color: #4c83ff;">:disable</span> (not disable)))
      (<span style="color: #4c83ff;">if</span> (not disable)
          (message <span style="color: #61CE3C;">"&#31105;&#29992;&#24403;&#21069;&#35789;&#24211;"</span>)
        (message <span style="color: #61CE3C;">"&#21551;&#29992;&#24403;&#21069;&#35789;&#24211;"</span>))
      (pyim-dm-refresh)
      (goto-char (point-min))
      (forward-line (- line 1)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-delete-dict</span> ()
  <span style="color: #FBDE2D;">"&#20174; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">' &#20013;&#21024;&#38500;&#24403;&#21069;&#34892;&#23545;&#24212;&#30340;&#35789;&#24211;&#20449;&#24687;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">when</span> (equal (buffer-name) pyim-dm-buffer)
    (<span style="color: #4c83ff;">let</span> ((id (get-text-property (point) 'id))
          (file (get-text-property (point) 'file))
          (line (line-number-at-pos)))
      (<span style="color: #4c83ff;">when</span> (yes-or-no-p <span style="color: #61CE3C;">"&#30830;&#23450;&#35201;&#21024;&#38500;&#36825;&#26465;&#35789;&#24211;&#20449;&#24687;&#21527;? "</span>)
        (<span style="color: #4c83ff;">setq</span> pyim-dicts (delq (nth (1- id) pyim-dicts) pyim-dicts))
        (pyim-dm-refresh)
        (goto-char (point-min))
        (forward-line (- line 1))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-dict-position-up</span> ()
  <span style="color: #FBDE2D;">"&#21521;&#19978;&#31227;&#21160;&#35789;&#24211;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">when</span> (equal (buffer-name) pyim-dm-buffer)
    (<span style="color: #4c83ff;">let*</span> ((id (get-text-property (point) 'id))
           (dict1 (nth (- id 1) pyim-dicts))
           (dict2 (nth (- id 2) pyim-dicts))
           (length (length pyim-dicts))
           (line (line-number-at-pos)))
      (<span style="color: #4c83ff;">when</span> (&gt; id 1)
        (<span style="color: #4c83ff;">setf</span> (nth (- id 1) pyim-dicts) dict2)
        (<span style="color: #4c83ff;">setf</span> (nth (- id 2) pyim-dicts) dict1)
        (pyim-dm-refresh)
        (goto-char (point-min))
        (forward-line (- line 2))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-dict-position-down</span> ()
  <span style="color: #FBDE2D;">"&#21521;&#19979;&#31227;&#21160;&#35789;&#24211;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">when</span> (equal (buffer-name) pyim-dm-buffer)
    (<span style="color: #4c83ff;">let*</span> ((id (get-text-property (point) 'id))
           (dict1 (nth (- id 1) pyim-dicts))
           (dict2 (nth id pyim-dicts))
           (length (length pyim-dicts))
           (line (line-number-at-pos)))
      (<span style="color: #4c83ff;">when</span> (&lt; id length)
        (<span style="color: #4c83ff;">setf</span> (nth (1- id) pyim-dicts) dict2)
        (<span style="color: #4c83ff;">setf</span> (nth id pyim-dicts) dict1)
        (pyim-dm-refresh)
        (goto-char (point-min))
        (forward-line line)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-save-dict-info</span> ()
  <span style="color: #FBDE2D;">"&#20351;&#29992; `</span><span style="color: #96CBFE;">customize-save-variable</span><span style="color: #FBDE2D;">' &#20989;&#25968;&#23558; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">' &#20445;&#23384;&#21040; ~/.emacs &#25991;&#20214;&#20013;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">&#23558;`</span><span style="color: #96CBFE; font-style: italic;">pyim-dict</span><span style="color: #8B8989; font-style: italic;">'&#30340;&#35774;&#32622;&#20445;&#23384;&#21040;emacs&#37197;&#32622;&#25991;&#20214;&#20013;&#12290;</span>
  (customize-save-variable 'pyim-dicts pyim-dicts)
  (message <span style="color: #61CE3C;">"&#23558; Chinese-pyim &#35789;&#24211;&#37197;&#32622;&#20449;&#24687;&#20445;&#23384;&#21040; ~/.emacs &#25991;&#20214;&#12290;"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dm-add-dict</span> ()
  <span style="color: #FBDE2D;">"&#20026; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">' &#28155;&#21152;&#35789;&#24211;&#20449;&#24687;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">when</span> (equal (buffer-name) pyim-dm-buffer)
    (<span style="color: #4c83ff;">let</span> ((line (line-number-at-pos))
          dict name file coding first-used dict-type)
      (<span style="color: #4c83ff;">setq</span> name (read-from-minibuffer <span style="color: #61CE3C;">"&#35831;&#36755;&#20837;&#35789;&#24211;&#21517;&#31216;&#65306; "</span>))
      (<span style="color: #4c83ff;">setq</span> file (read-file-name <span style="color: #61CE3C;">"&#35831;&#36873;&#25321;&#35789;&#24211;&#25991;&#20214;&#65306; "</span> <span style="color: #61CE3C;">"~/"</span>))
      (<span style="color: #4c83ff;">setq</span> first-used  (yes-or-no-p <span style="color: #61CE3C;">"&#26159;&#21542;&#35753; Chinese-pyim &#20248;&#20808;&#20351;&#29992;&#35789;&#24211;&#65311; "</span>))
      (<span style="color: #4c83ff;">setq</span> dict `(<span style="color: #4c83ff;">:name</span> ,name <span style="color: #4c83ff;">:file</span> ,file))
      (<span style="color: #4c83ff;">if</span> first-used
          (add-to-list 'pyim-dicts dict)
        (add-to-list 'pyim-dicts dict t))
      (pyim-dm-refresh)
      (goto-char (point-min))
      (forward-line (- line 1)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">define-derived-mode</span> <span style="color: #ff1493;">pyim-dm-mode</span> special-mode <span style="color: #61CE3C;">"pyim-dicts-manager"</span>
  <span style="color: #FBDE2D;">"Major mode for managing Chinese-pyim dicts"</span>
  (read-only-mode)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"D"</span>) 'pyim-dm-delete-dict)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"g"</span>) 'pyim-dm-refresh)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"A"</span>) 'pyim-dm-add-dict)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"N"</span>) 'pyim-dm-dict-position-down)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"P"</span>) 'pyim-dm-dict-position-up)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"s"</span>) 'pyim-dm-save-dict-info)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"C-c C-c"</span>) 'pyim-dm-toggle-dict)
  (define-key pyim-dm-mode-map (kbd <span style="color: #61CE3C;">"R"</span>) 'pyim-restart))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dicts-manager</span> ()
  <span style="color: #FBDE2D;">"Chinese-pyim &#35789;&#24211;&#31649;&#29702;&#22120;&#12290;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">let</span> ((buffer (get-buffer-create pyim-dm-buffer)))
    (pyim-dm-refresh)
    (switch-to-buffer buffer)
    (pyim-dm-mode)
    (<span style="color: #4c83ff;">setq</span> truncate-lines t)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-extra-dicts-add-dict</span> (new-dict)
  <span style="color: #FBDE2D;">"&#28155;&#21152; `</span><span style="color: #96CBFE;">new-dict</span><span style="color: #FBDE2D;">' &#21040; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">', &#20854;&#20013; `</span><span style="color: #96CBFE;">new-dict</span><span style="color: #FBDE2D;">' &#30340;&#26684;&#24335;&#20026;&#65306;</span>

<span style="color: #FBDE2D;">   (:name \"XXX\" :file \"/path/to/XXX.pyim\")</span>

<span style="color: #FBDE2D;">&#36825;&#20010;&#20989;&#25968;&#29992;&#20110;&#21046;&#20316; elpa &#26684;&#24335;&#30340;&#35789;&#24211; &#65292;&#19981;&#24314;&#35758;&#26222;&#36890;&#29992;&#25143;&#20351;&#29992;&#12290;"</span>
  (<span style="color: #4c83ff;">let</span> (replace result)
    (<span style="color: #4c83ff;">dolist</span> (dict pyim-extra-dicts)
      (<span style="color: #4c83ff;">if</span> (equal (plist-get dict <span style="color: #4c83ff;">:name</span>)
                 (plist-get new-dict <span style="color: #4c83ff;">:name</span>))
          (<span style="color: #4c83ff;">progn</span> (<span style="color: #4c83ff;">push</span> new-dict result)
                 (<span style="color: #4c83ff;">setq</span> replace t))
        (<span style="color: #4c83ff;">push</span> dict result)))
    (<span style="color: #4c83ff;">setq</span> result (reverse result))
    (<span style="color: #4c83ff;">setq</span> pyim-extra-dicts
          (<span style="color: #4c83ff;">if</span> replace result `(,@result ,new-dict)))
    (message <span style="color: #61CE3C;">"Add Chinese-pyim dict %S to `</span><span style="color: #96CBFE;">pyim-extra-dicts</span><span style="color: #61CE3C;">'&#12290;"</span> (plist-get new-dict <span style="color: #4c83ff;">:name</span>))
    t))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dict-name-available-p</span> (dict-name)
  <span style="color: #FBDE2D;">"&#26597;&#35810; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">' &#20013; `</span><span style="color: #96CBFE;">:name</span><span style="color: #FBDE2D;">' &#20026; `</span><span style="color: #96CBFE;">dict-name</span><span style="color: #FBDE2D;">' &#30340;&#35789;&#24211;&#20449;&#24687;&#26159;&#21542;&#23384;&#22312;&#12290;</span>
<span style="color: #FBDE2D;">  &#36825;&#20010;&#20989;&#25968;&#20027;&#35201;&#29992;&#20110;&#35789;&#24211; package&#12290;"</span>
  (cl-some (<span style="color: #4c83ff;">lambda</span> (x)
             (<span style="color: #4c83ff;">let</span> ((name (plist-get x <span style="color: #4c83ff;">:name</span>)))
               (equal name dict-name)))
           pyim-dicts))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">pyim-dict-file-available-p</span> (dict-file)
  <span style="color: #FBDE2D;">"&#26597;&#35810; `</span><span style="color: #96CBFE;">pyim-dicts</span><span style="color: #FBDE2D;">' &#20013; `</span><span style="color: #96CBFE;">:file</span><span style="color: #FBDE2D;">' &#20026; `</span><span style="color: #96CBFE;">dict-file</span><span style="color: #FBDE2D;">' &#30340;&#35789;&#24211;&#20449;&#24687;&#26159;&#21542;&#23384;&#22312;&#12290;</span>
<span style="color: #FBDE2D;">  &#36825;&#20010;&#20989;&#25968;&#20027;&#35201;&#29992;&#20110;&#35789;&#24211; package&#12290;"</span>
  (cl-some (<span style="color: #4c83ff;">lambda</span> (x)
             (<span style="color: #4c83ff;">let</span> ((file (plist-get x <span style="color: #4c83ff;">:file</span>)))
               (equal (expand-file-name file)
                      (expand-file-name dict-file))))
           pyim-dicts))
</pre>
</div>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2017-03-10</span>
        <span title="last modification date" class="post-info">2017-03-10</span>
        <span title="tags" class="post-info">N/A</span>
        <span title="author" class="post-info">Feng Shu</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'tumashu-website'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; <span id="footerYear"></span> <a href="mailto:tumashu &lt;at&gt; 163 &lt;dot&gt; com">Feng Shu</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/tumashu/org-webpage" target="_blank">org-webpage</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

</div>
</body>
</html>
