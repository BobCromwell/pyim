<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>chinese-pyim - Chinese-pyim</title>
    <meta charset="utf-8" />
    <meta name="author" content="Feng Shu" />
    <link rel="stylesheet" href="http://tumashu.github.com/chinese-pyim/media/css/main.css" type="text/css">
  </head>
<body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="http://tumashu.github.com/chinese-pyim/">Chinese-pyim</a> <span class="subtitle">(一个 emacs 环境下的中文拼音输入法)</span></h1>
        <ul>
          <li><a href="http://tumashu.github.com/chinese-pyim/documents/">Documents</a></li>
          <li><a href="http://tumashu.github.com/chinese-pyim/snapshots/">Snapshots</a></li>
          <li><a href="http://tumashu.github.com/chinese-pyim/tags/">Tags</a></li>
          <li><a href="http://tumashu.github.com/chinese-pyim/about/">About</a></li>
          <li><a href="https://github.com/tumashu/chinese-pyim">GitHub</a></li>
          <li><a href="http://tumashu.github.com/chinese-pyim/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="tumashu.github.com/chinese-pyim">
        </form>
        <img class="avatar" src="http://tumashu.github.com/chinese-pyim/media/img/horse.jpg" />
      </header>
    </div>

<div class="content-and-footer">
<div>
<div class="post">
<h1 class="post-title">chinese-pyim</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5ebeb42">1. Chinese-pyim 使用说明&#xa0;&#xa0;&#xa0;<span class="tag"><span class="README">README</span>&#xa0;<span class="doc">doc</span></span></a>
<ul>
<li><a href="#org82bcfda">1.1. 截图</a></li>
<li><a href="#orged71285">1.2. 简介</a></li>
<li><a href="#org82543fd">1.3. 背景</a></li>
<li><a href="#orgf7db4cb">1.4. 目标</a></li>
<li><a href="#org7df5422">1.5. 特点</a></li>
<li><a href="#orga69b3de">1.6. 安装</a></li>
<li><a href="#org2b5f924">1.7. 配置</a>
<ul>
<li><a href="#org75019e3">1.7.1. 配置实例</a></li>
<li><a href="#org42f8ad1">1.7.2. 添加词库文件</a></li>
<li><a href="#orgc5ee29a">1.7.3. 激活 Chinese-pyim</a></li>
</ul>
</li>
<li><a href="#org556ee01">1.8. 使用</a>
<ul>
<li><a href="#org397d659">1.8.1. 常用快捷键</a></li>
<li><a href="#orga5b6ab8">1.8.2. 使用双拼模式</a></li>
<li><a href="#orgce27ba0">1.8.3. 让选词框跟随光标</a></li>
<li><a href="#org7ff8960">1.8.4. 调整 tooltip 选词框的显示样式</a></li>
<li><a href="#org93425d6">1.8.5. 设置模糊音</a></li>
<li><a href="#org3979826">1.8.6. 词语联想</a></li>
<li><a href="#org79d8090">1.8.7. 切换全角标点与半角标点</a></li>
<li><a href="#orgc37f61e">1.8.8. 手动加词和删词</a></li>
<li><a href="#org2d8ced0">1.8.9. Chinese-pyim 高级功能</a>
<ul>
<li><a href="#orgb2696fe">1.8.9.1. 根据环境自动切换到英文输入模式</a></li>
<li><a href="#org8252c09">1.8.9.2. 根据环境自动切换到半角标点输入模式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge22d57b">1.9. 捐赠</a></li>
<li><a href="#org3189037">1.10. Tips</a>
<ul>
<li><a href="#orgdab2dee">1.10.1. Chinese-pyim 出现错误时，如何开启 debug 模式</a></li>
<li><a href="#org159ebe5">1.10.2. 选词框弹出位置不合理或者选词框内容显示不全</a></li>
<li><a href="#org9ec71e9">1.10.3. 如何查看 Chinese-pyim 文档。</a></li>
<li><a href="#orga5e71f1">1.10.4. 将光标处的拼音字符串转换为中文 (与 vimim 的 “点石成金” 功能类似)</a></li>
<li><a href="#org3391997">1.10.5. 如何添加自定义拼音词库</a>
<ul>
<li><a href="#org16b2025">1.10.5.1. 第一种方式 (懒人推荐使用)</a></li>
<li><a href="#org64d5329">1.10.5.2. 第二种方式 (Windows 用户推荐使用)</a></li>
<li><a href="#orgfee85d3">1.10.5.3. 第三种方式 (Linux &amp; Unix 用户推荐使用)</a></li>
<li><a href="#org27bcded">1.10.5.4. 第四种方式 (喜欢折腾的人推荐使用)</a></li>
</ul>
</li>
<li><a href="#orga77f2f7">1.10.6. 如何手动安装和管理词库</a></li>
<li><a href="#orgd4cae15">1.10.7. 如何合并两个词库文件</a></li>
<li><a href="#org62ea598">1.10.8. 如何快速切换词库</a></li>
<li><a href="#org8024014">1.10.9. 将汉字字符串转换为拼音字符串</a></li>
<li><a href="#org0c7b1a8">1.10.10. 中文分词</a></li>
<li><a href="#org6241546">1.10.11. 获取光标处的中文词条</a></li>
<li><a href="#orgd6bea42">1.10.12. 让 `forward-word' 和 `back-backward’ 在中文环境下正常工作</a></li>
<li><a href="#orgb6ed0d5">1.10.13. 为 isearch 相关命令添加拼音搜索支持</a></li>
<li><a href="#org35d4d7b">1.10.14. 使用 Chinese-pyim 改善 company-mode 中文补全的体验</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5f562dd">2. 代码&#xa0;&#xa0;&#xa0;<span class="tag"><span class="code">code</span></span></a></li>
</ul>
</div>
</div>
<div id="outline-container-org5ebeb42" class="outline-2">
<h2 id="org5ebeb42"><span class="section-number-2">1</span> Chinese-pyim 使用说明&#xa0;&#xa0;&#xa0;<span class="tag"><span class="README">README</span>&#xa0;<span class="doc">doc</span></span></h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-org82bcfda" class="outline-3">
<h3 id="org82bcfda"><span class="section-number-3">1.1</span> 截图</h3>
<div class="outline-text-3" id="text-1-1">

<div class="figure">
<p><img src="http://tumashu.github.com/chinese-pyim/assets/documents/chinese-pyim/pyim-linux-x-with-toolkit.png" alt="pyim-linux-x-with-toolkit.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orged71285" class="outline-3">
<h3 id="orged71285"><span class="section-number-3">1.2</span> 简介</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Chinese-pyim (Chinese Pinyin Input Method) 是 emacs 环境下的一个中文拼音输入法。
</p>
</div>
</div>


<div id="outline-container-org82543fd" class="outline-3">
<h3 id="org82543fd"><span class="section-number-3">1.3</span> 背景</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Chinese-pyim 的代码源自 emacs-eim。
</p>

<p>
emacs-eim 是 emacs 环境下的一个中文输入法框架， 支持拼音，五笔，仓颉以及二笔等多种输入法，但遗憾的是，2008 年之后它就停止了开发，我认为主要原因是外部中文输入法快速发展。
</p>

<p>
虽然外部输入法功能强大，但不能和 emacs 默契的配合，这一点极大的损害了 emacs 那种<b>行云流水</b>
的感觉。而本人在使用（或者叫折腾） emacs-eim 的过程中发现：
</p>

<ol class="org-ol">
<li><b>当 emacs-eim 拼音词库词条超过100万时，选词频率大大降低，中文体验增强。</b></li>
<li><b>随着使用时间的延长，emacs-eim会越来越好用（个人词库的积累）。</b></li>
</ol>

<p>
于是我 fork 了 emacs-eim 拼音输入法相关的代码, 创建了一个项目：chinese-pyim。
</p>
</div>
</div>

<div id="outline-container-orgf7db4cb" class="outline-3">
<h3 id="orgf7db4cb"><span class="section-number-3">1.4</span> 目标</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Chinese-pyim 的目标是：<b>尽最大的努力成为一个好用的 emacs 中文拼音输入法</b>，具体可表现为三个方面：
</p>

<ol class="org-ol">
<li>Fallback:     当外部输入法不能使用时，比如在 console或者cygwin环境下，尽最大可能让 emacs 用户不必为输入中文而烦恼。</li>
<li>Integration:  尽最大可能减少输入法切换频率，让中文输入不影响 emacs
的体验。</li>
<li>Exchange:     尽最大可能简化 Chinese-pyim 使用其他优秀输入法的词库的难度和复杂度。</li>
</ol>
</div>
</div>

<div id="outline-container-org7df5422" class="outline-3">
<h3 id="org7df5422"><span class="section-number-3">1.5</span> 特点</h3>
<div class="outline-text-3" id="text-1-5">
<ol class="org-ol">
<li>Chinese-pyim 只是一个拼音输入法，安装配置方便快捷，一般只能通过添加词库的方式优化输入法。</li>
<li>Chinese-pyim 只使用最简单的文本词库格式，可以快速方便的利用其他输入法的词库。</li>
</ol>
</div>
</div>

<div id="outline-container-orga69b3de" class="outline-3">
<h3 id="orga69b3de"><span class="section-number-3">1.6</span> 安装</h3>
<div class="outline-text-3" id="text-1-6">
<ol class="org-ol">
<li>配置melpa源，参考：<a href="http://melpa.org/#/getting-started">http://melpa.org/#/getting-started</a></li>
<li>M-x package-install RET chinese-pyim RET</li>
<li>在emacs配置文件中（比如: ~/.emacs）添加如下代码：</li>
</ol>

<pre class="example">
(require 'chinese-pyim)
</pre>
</div>
</div>

<div id="outline-container-org2b5f924" class="outline-3">
<h3 id="org2b5f924"><span class="section-number-3">1.7</span> 配置</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-org75019e3" class="outline-4">
<h4 id="org75019e3"><span class="section-number-4">1.7.1</span> 配置实例</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
对 Chinese-pyim 感兴趣的同学，可以看看我的 Chinese-pyim 配置，大体了解一下 Chinese-pyim 的用法：<a href="https://github.com/tumashu/emacs-helper/blob/master/eh-basic.el">Tumashu's emacs configure</a>。
</p>
</div>
</div>

<div id="outline-container-org42f8ad1" class="outline-4">
<h4 id="org42f8ad1"><span class="section-number-4">1.7.2</span> 添加词库文件</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
添加词库最简单的方式是直接安装 chinese-pyim-greatdict 。
</p>

<p>
<a href="https://github.com/tumashu/chinese-pyim-greatdict">https://github.com/tumashu/chinese-pyim-greatdict</a>
</p>

<p>
Chinese-pyim-greatdict 包对应的词库由<a href="https://github.com/xiaowl">WenLiang Xiao</a>同学开发制作，词条有 300 万条，词库文件大约 80M, 是一个<b>大而全</b>的词库，用户可以通过 Melpa 来安装它：
</p>

<ol class="org-ol">
<li>配置melpa源，参考：<a href="http://melpa.org/#/getting-started">http://melpa.org/#/getting-started</a></li>
<li>M-x package-install RET chinese-pyim-greatdict RET</li>
<li><p>
在emacs配置文件中（比如: ~/.emacs）添加如下代码：
</p>

<pre class="example">
(require 'chinese-pyim-greatdict)
(chinese-pyim-greatdict-enable)
</pre></li>
</ol>

<p>
但值得注意的是：
</p>

<ol class="org-ol">
<li>如果机器性能不好，安装 chinese-pyim-greatdict 会导致 chinese-pyim 启动非常缓慢，请仔细考虑。</li>
<li>这个词库使用 gzip 压缩，非 Linux 用户需要安装<a href="http://www.gzip.org/">gzip</a>程序，并配置好系统 PATH 。</li>
</ol>

<p>
如果 chinese-pyim-greatdict 不能满足需求，用户可以使用其他方式为 Chinese-pyim 添加拼音词库，具体方式请参考<a href="#org3391997">1.10.5</a>小结。
</p>
</div>
</div>

<div id="outline-container-orgc5ee29a" class="outline-4">
<h4 id="orgc5ee29a"><span class="section-number-4">1.7.3</span> 激活 Chinese-pyim</h4>
<div class="outline-text-4" id="text-1-7-3">
<pre class="example">
(setq default-input-method "chinese-pyim")
(global-set-key (kbd "C-\\") 'toggle-input-method)
</pre>
</div>
</div>
</div>

<div id="outline-container-org556ee01" class="outline-3">
<h3 id="org556ee01"><span class="section-number-3">1.8</span> 使用</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-org397d659" class="outline-4">
<h4 id="org397d659"><span class="section-number-4">1.8.1</span> 常用快捷键</h4>
<div class="outline-text-4" id="text-1-8-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">输入法快捷键</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-n 或 M-n 或 +</td>
<td class="org-left">向下翻页</td>
</tr>

<tr>
<td class="org-left">C-p 或 M-p 或 -</td>
<td class="org-left">向上翻页</td>
</tr>

<tr>
<td class="org-left">C-f</td>
<td class="org-left">选择下一个备选词</td>
</tr>

<tr>
<td class="org-left">C-b</td>
<td class="org-left">选择上一个备选词</td>
</tr>

<tr>
<td class="org-left">SPC</td>
<td class="org-left">确定输入</td>
</tr>

<tr>
<td class="org-left">RET 或 C-m</td>
<td class="org-left">字母上屏</td>
</tr>

<tr>
<td class="org-left">C-c</td>
<td class="org-left">取消输入</td>
</tr>

<tr>
<td class="org-left">C-g</td>
<td class="org-left">取消输入并保留已输入的中文</td>
</tr>

<tr>
<td class="org-left">TAB</td>
<td class="org-left">模糊音调整</td>
</tr>

<tr>
<td class="org-left">DEL 或 BACKSPACE</td>
<td class="org-left">删除最后一个字符</td>
</tr>

<tr>
<td class="org-left">C-DEL 或  C-BACKSPACE</td>
<td class="org-left">删除最后一个拼音</td>
</tr>

<tr>
<td class="org-left">M-DEL 或  M-BACKSPACE</td>
<td class="org-left">删除最后一个拼音</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orga5b6ab8" class="outline-4">
<h4 id="orga5b6ab8"><span class="section-number-4">1.8.2</span> 使用双拼模式</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
Chinese-pyim 支持双拼模式，用户可以通过变量 `pyim-default-pinyin-scheme' 来设定当前使用的双拼方案，比如：
</p>

<pre class="example">
(setq pyim-default-pinyin-scheme 'pyim-shuangpin)
</pre>

<p>
注意：
</p>
<ol class="org-ol">
<li>用户可以使用变量 `pyim-pinyin-schemes' 添加自定义双拼方案。</li>
<li>用户可能需要重新设置 `pyim-translate-trigger-char'。</li>
</ol>
</div>
</div>

<div id="outline-container-orgce27ba0" class="outline-4">
<h4 id="orgce27ba0"><span class="section-number-4">1.8.3</span> 让选词框跟随光标</h4>
<div class="outline-text-4" id="text-1-8-3">
<p>
用户可以通过下面的设置让 Chinese-pyim 在<b>光标处</b>显示一个选词框：
</p>

<ol class="org-ol">
<li><p>
使用 popup 包来绘制选词框 （emacs overlay 机制）
</p>
<pre class="example">
(setq pyim-use-tooltip 'popup)
</pre></li>
<li><p>
使用 pos-tip 包来绘制选词框（emacs tooltip 机制）
</p>
<pre class="example">
(setq pyim-use-tooltip 'pos-tip)
</pre></li>
</ol>

<p>
注：Linux 平台下，emacs 可以使用 GTK 来绘制选词框：
</p>

<pre class="example">
(setq pyim-use-tooltip 'pos-tip)
(setq x-gtk-use-system-tooltips t)
</pre>

<p>
GTK 选词框的字体设置可以参考：<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/GTK-resources.html#GTK-resources">GTK resources</a>。
</p>
</div>
</div>

<div id="outline-container-org7ff8960" class="outline-4">
<h4 id="org7ff8960"><span class="section-number-4">1.8.4</span> 调整 tooltip 选词框的显示样式</h4>
<div class="outline-text-4" id="text-1-8-4">
<p>
Chinese-pyim 的 tooltip 选词框默认使用<b>双行显示</b>的样式，在一些特殊的情况下（比如：popup 显示的菜单错位），用户可以使用<b>单行显示</b>
的样式：
</p>

<pre class="example">
(setq pyim-guidance-format-function 'pyim-guidance-format-function-one-line)
</pre>

<p>
注：用户也可以自定义 guidance 格式化函数。
</p>
</div>
</div>

<div id="outline-container-org93425d6" class="outline-4">
<h4 id="org93425d6"><span class="section-number-4">1.8.5</span> 设置模糊音</h4>
<div class="outline-text-4" id="text-1-8-5">
<p>
可以通过设置 `pyim-fuzzy-pinyin-alist' 变量来自定义模糊音。
</p>
</div>
</div>

<div id="outline-container-org3979826" class="outline-4">
<h4 id="org3979826"><span class="section-number-4">1.8.6</span> 词语联想</h4>
<div class="outline-text-4" id="text-1-8-6">
<p>
Chinese-pyim <b>内置</b>了5种词语联想方式：
</p>

<ol class="org-ol">
<li>`pinyin-shouzimu' 搜索拼音首字母对应的词条做为联想词，如果输入 "ni-hao" ，那么同时搜索 code 为 "n-h" 的词条做为联想词。</li>
<li>`pinyin-znabc' 类似智能ABC的词语联想(源于 emacs-eim)。</li>
<li><p>
`guess-words' 以上次输入的词条为 code，然后在 guessdict 中搜索，用搜索得到的词条来提高输入法识别精度。
</p>

<p>
注意：这个方法需要用户安装 guessdict 词库，guessdict 词库文件可以用 `pyim-article2dict-guessdict' 命令生成，不想折腾的用户也可以从下面的地址下载样例词库：
</p>

<p>
<a href="http://tumashu.github.io/chinese-pyim-guessdict/pyim-guessdict.gpyim.gz">http://tumashu.github.io/chinese-pyim-guessdict/pyim-guessdict.gpyim.gz</a>
</p></li>

<li><p>
`dabbrev'  搜索当前 buffer, 或者其他 buffer 中已经存在的中文文本，得到匹配的候选词，通过这些候选词来提高输入法的识别精度。
</p>

<p>
注意: 如果 emacs 打开的 buffer 太多或者太大, 输入法<b>可能</b>出现卡顿。
</p></li>
</ol>

<p>
Chinese-pyim 默认开启了词语联想功能，但用户可以通过下面的代码来调整设置，比如：
</p>

<pre class="example">
(setq pyim-enable-words-predict '(dabbrev pinyin-shouzimu guess-words))
</pre>

<p>
开启词语联想功能有时候会导致输入法卡顿，用户可以通过下面的方式关闭：
</p>

<pre class="example">
(setq pyim-enable-words-predict nil)
</pre>
</div>
</div>

<div id="outline-container-org79d8090" class="outline-4">
<h4 id="org79d8090"><span class="section-number-4">1.8.7</span> 切换全角标点与半角标点</h4>
<div class="outline-text-4" id="text-1-8-7">
<ol class="org-ol">
<li>第一种方法：使用命令 `pyim-toggle-full-width-punctuation'，全局切换。</li>
<li>第二种方法：使用命令 `pyim-punctuation-translate-at-point' 只切换光标处标点的样式。</li>
<li>第三种方法：设置变量 `pyim-translate-trigger-char' ，输入变量设定的字符会切换光标处标点的样式。</li>
</ol>
</div>
</div>

<div id="outline-container-orgc37f61e" class="outline-4">
<h4 id="orgc37f61e"><span class="section-number-4">1.8.8</span> 手动加词和删词</h4>
<div class="outline-text-4" id="text-1-8-8">
<ol class="org-ol">
<li>`pyim-create-word-without-pinyin' 直接将一个中文词条加入个人词库的函数，用于编程环境。</li>
<li>`pyim-create-word-at-point:"N"char' 这是一组命令，从光标前提取N个汉字字符组成字符串，并将其加入个人词库。</li>
<li>`pyim-translate-trigger-char' 以默认设置为例：在“我爱吃红烧肉”后输入“5v” 可以将“爱吃红烧肉”这个词条保存到用户个人词频文件。</li>
<li>`pyim-create-word-from-selection', 选择一个词条，运行这个命令后，就可以将这个词条添加到个人文件。</li>
<li>`pyim-delete-word-from-personal-buffer' 从个人词频文件对应的 buffer
中删除当前高亮选择的词条。</li>
</ol>
</div>
</div>

<div id="outline-container-org2d8ced0" class="outline-4">
<h4 id="org2d8ced0"><span class="section-number-4">1.8.9</span> Chinese-pyim 高级功能</h4>
<div class="outline-text-4" id="text-1-8-9">
<ol class="org-ol">
<li>根据环境自动切换到英文输入模式，使用 pyim-english-input-switch-functions 配置。</li>
<li>根据环境自动切换到半角标点输入模式，使用 pyim-punctuation-half-width-functions 配置。</li>
</ol>

<p>
注意：上述两个功能使用不同的变量设置，<b>千万不要搞错</b>。
</p>
</div>

<div id="outline-container-orgb2696fe" class="outline-5">
<h5 id="orgb2696fe"><span class="section-number-5">1.8.9.1</span> 根据环境自动切换到英文输入模式</h5>
<div class="outline-text-5" id="text-1-8-9-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">探针函数</th>
<th scope="col" class="org-left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pyim-probe-program-mode</td>
<td class="org-left">如果当前的 mode 衍生自 prog-mode，那么仅仅在字符串和 comment 中开启中文输入模式</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-org-speed-commands</td>
<td class="org-left">解决 org-speed-commands 与 Chinese-pyim 冲突问题</td>
</tr>

<tr>
<td class="org-left">pyim-probe-isearch-mode</td>
<td class="org-left">使用 isearch 搜索时，强制开启英文输入模式</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">注意：想要使用这个功能，pyim-isearch-enable-pinyin-search 必须设置为 t</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-org-structure-template</td>
<td class="org-left">使用 org-structure-template 时，关闭中文输入模式</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">1. 当前字符为中文字符时，输入下一个字符时默认开启中文输入</td>
</tr>

<tr>
<td class="org-left">pyim-probe-dynamic-english</td>
<td class="org-left">2. 当前字符为其他字符时，输入下一个字符时默认开启英文输入</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">3. 使用命令 pyim-convert-pinyin-at-point 可以将光标前的拼音字符串强制转换为中文。</td>
</tr>
</tbody>
</table>

<p>
激活方式：
</p>

<pre class="example">
(setq-default pyim-english-input-switch-functions
              '(probe-function1 probe-function2 probe-function3))
</pre>

<p>
注：上述函数列表中，任意一个函数的返回值为 t 时，Chinese-pyim 切换到英文输入模式。
</p>
</div>
</div>

<div id="outline-container-org8252c09" class="outline-5">
<h5 id="org8252c09"><span class="section-number-5">1.8.9.2</span> 根据环境自动切换到半角标点输入模式</h5>
<div class="outline-text-5" id="text-1-8-9-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">探针函数</th>
<th scope="col" class="org-left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pyim-probe-punctuation-line-beginning</td>
<td class="org-left">行首强制输入半角标点</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-punctuation-after-punctuation</td>
<td class="org-left">半角标点后强制输入半角标点</td>
</tr>
</tbody>
</table>

<p>
激活方式：
</p>

<pre class="example">
(setq-default pyim-punctuation-half-width-functions
              '(probe-function4 probe-function5 probe-function6))
</pre>

<p>
注：上述函数列表中，任意一个函数的返回值为 t 时，Chinese-pyim 切换到半角标点输入模式。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orge22d57b" class="outline-3">
<h3 id="orge22d57b"><span class="section-number-3">1.9</span> 捐赠</h3>
<div class="outline-text-3" id="text-1-9">
<p>
您可以通过小额捐赠的方式支持 Chinese-pyim 的开发工作，具体方式：
</p>

<ol class="org-ol">
<li>通过支付宝收款账户：tumashu@163.com</li>
<li><p>
通过支付宝钱包扫描：
</p>


<div class="figure">
<p><img src="http://tumashu.github.com/chinese-pyim/assets/documents/chinese-pyim/QR-code-for-author.jpg" alt="QR-code-for-author.jpg" />
</p>
</div></li>
</ol>
</div>
</div>


<div id="outline-container-org3189037" class="outline-3">
<h3 id="org3189037"><span class="section-number-3">1.10</span> Tips</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-orgdab2dee" class="outline-4">
<h4 id="orgdab2dee"><span class="section-number-4">1.10.1</span> Chinese-pyim 出现错误时，如何开启 debug 模式</h4>
<div class="outline-text-4" id="text-1-10-1">
<pre class="example">
(setq debug-on-error t)
</pre>
</div>
</div>

<div id="outline-container-org159ebe5" class="outline-4">
<h4 id="org159ebe5"><span class="section-number-4">1.10.2</span> 选词框弹出位置不合理或者选词框内容显示不全</h4>
<div class="outline-text-4" id="text-1-10-2">
<p>
可以通过设置 `pyim-tooltip-width-adjustment' 变量来手动校正。
</p>

<ol class="org-ol">
<li>选词框内容显示不全：增大变量值</li>
<li>选词框弹出位置不合理：减小变量值</li>
</ol>
</div>
</div>

<div id="outline-container-org9ec71e9" class="outline-4">
<h4 id="org9ec71e9"><span class="section-number-4">1.10.3</span> 如何查看 Chinese-pyim 文档。</h4>
<div class="outline-text-4" id="text-1-10-3">
<p>
Chinese-pyim 开发使用 lentic 文学编程模式，代码文档隐藏在comment中，如果用户喜欢阅读 html 格式的文档，可以查看在线文档；
</p>

<p>
<a href="http://tumashu.github.io/chinese-pyim/">http://tumashu.github.io/chinese-pyim/</a>
</p>
</div>
</div>

<div id="outline-container-orga5e71f1" class="outline-4">
<h4 id="orga5e71f1"><span class="section-number-4">1.10.4</span> 将光标处的拼音字符串转换为中文 (与 vimim 的 “点石成金” 功能类似)</h4>
<div class="outline-text-4" id="text-1-10-4">
<pre class="example">
(global-set-key (kbd "M-i") 'pyim-convert-pinyin-at-point)
</pre>
</div>
</div>

<div id="outline-container-org3391997" class="outline-4">
<h4 id="org3391997"><span class="section-number-4">1.10.5</span> 如何添加自定义拼音词库</h4>
<div class="outline-text-4" id="text-1-10-5">
<p>
Chinese-pyim 默认没有携带任何拼音词库，用户可以使用下面五种方式，获取质量较好的拼音词库：
</p>
</div>

<div id="outline-container-org16b2025" class="outline-5">
<h5 id="org16b2025"><span class="section-number-5">1.10.5.1</span> 第一种方式 (懒人推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-5-1">
<p>
获取其他 Chinese-pyim 用户的拼音词库，比如，某个同学测试 Chinese-pyim
时创建了一个中文拼音词库，词条数量大约60万。
</p>

<p>
<a href="http://tumashu.github.io/chinese-pyim-bigdict/pyim-bigdict.pyim.gz">http://tumashu.github.io/chinese-pyim-bigdict/pyim-bigdict.pyim.gz</a>
</p>

<p>
下载上述词库后，运行 `pyim-dicts-manager' ，按照命令提示，将下载得到的词库文件信息添加到 `pyim-dicts' 中，最后运行命令 `pyim-restart' 或者重启
emacs，这个词库使用 `utf-8-unix' 编码。
</p>
</div>
</div>

<div id="outline-container-org64d5329" class="outline-5">
<h5 id="org64d5329"><span class="section-number-5">1.10.5.2</span> 第二种方式 (Windows 用户推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-5-2">
<p>
使用词库转换工具将其他输入法的词库转化为Chinese-pyim使用的词库：这里只介绍windows平台下的一个词库转换软件：
</p>

<ol class="org-ol">
<li>软件名称： imewlconverter</li>
<li>中文名称： 深蓝词库转换</li>
<li>下载地址：<a href="https://github.com/studyzy/imewlconverter">https://github.com/studyzy/imewlconverter</a></li>
<li>依赖平台： Microsoft .NET Framework (&gt;= 3.5)</li>
</ol>

<p>
使用方式：
</p>


<div class="figure">
<p><img src="http://tumashu.github.com/chinese-pyim/assets/documents/chinese-pyim/imewlconverter-basic.gif" alt="imewlconverter-basic.gif" />
</p>
</div>

<p>
如果生成的词库词频不合理，可以按照下面的方式处理（非常有用的功能）：
</p>


<div class="figure">
<p><img src="http://tumashu.github.com/chinese-pyim/assets/documents/chinese-pyim/imewlconverter-wordfreq.gif" alt="imewlconverter-wordfreq.gif" />
</p>
</div>

<p>
生成词库后，运行 `pyim-dicts-manager' ，按照命令提示，将转换得到的词库文件的信息添加到 `pyim-dicts' 中，完成后运行命令 `pyim-restart' 或者重启emacs。
</p>
</div>
</div>

<div id="outline-container-orgfee85d3" class="outline-5">
<h5 id="orgfee85d3"><span class="section-number-5">1.10.5.3</span> 第三种方式 (Linux &amp; Unix 用户推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-5-3">
<p>
E-Neo 同学编写了一个简单的词库转换工具: <a href="https://github.com/E-Neo/scel2pyim">scel2pyim</a> ,
这个小工具可以直接将搜狗输入法的细胞词库转换为 Chinese-pyim 使用的文本词库，
pyim-dicts-manager 中 “导入搜狗输入法细胞词库” 功能就是依靠这个工具实现。
</p>

<ol class="org-ol">
<li>软件名称： scel2pyim</li>
<li>下载地址：<a href="https://github.com/E-Neo/scel2pyim">https://github.com/E-Neo/scel2pyim</a></li>
<li>编写语言： C语言</li>
</ol>

<p>
按照说明安装好 scel2pyim 后，将scel2pyim命令所在的目录添加到系统PATH，或者在 emacs 配置文件中添加代码：
</p>

<pre class="example">
(setq pyim-dicts-manager-scel2pyim-command "/path/to/scel2pyim")
</pre>
</div>
</div>

<div id="outline-container-org27bcded" class="outline-5">
<h5 id="org27bcded"><span class="section-number-5">1.10.5.4</span> 第四种方式 (喜欢折腾的人推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-5-4">
<p>
获取中文词条，然后使用命令为词条添加拼音code。中文词条的获取途径很多，比如：
</p>

<ol class="org-ol">
<li>从其它输入法中导出。</li>
<li>获取中文文章，通过分词系统分词得到。</li>
<li>中文处理工具自带的dict。</li>
<li>其它。</li>
</ol>

<p>
相关命令有三个：
</p>

<ol class="org-ol">
<li>`pyim-article2dict-chars' 将文章中游离汉字字符转换为拼音词库。</li>
<li>`pyim-article2dict-words' 将文章中中文词语转换为拼音词库。</li>
<li>`pyim-article2dict-misspell-words' 将文章中连续的游离词组成字符串后，转换为拼音词库。</li>
<li>`pyim-article2dict-guessdict' 将文章中词条转换为 guessdict词库。</li>
</ol>

<p>
注意：在运行上述两个命令之前，必须确保待转换的文章中，中文词汇已经使用
<b>空格</b>强制隔开。
</p>

<p>
最后将生成的词库按上述方法添加到 Chinese-pyim 中就可以了。
</p>
</div>
</div>
</div>

<div id="outline-container-orga77f2f7" class="outline-4">
<h4 id="orga77f2f7"><span class="section-number-4">1.10.6</span> 如何手动安装和管理词库</h4>
<div class="outline-text-4" id="text-1-10-6">
<p>
这里假设有两个词库文件：
</p>

<ol class="org-ol">
<li>/path/to/pyim-dict1.pyim</li>
<li>/path/to/pyim-dict2.pyim</li>
</ol>

<p>
在~/.emacs文件中添加如下一行配置。
</p>

<pre class="example">
(setq pyim-dicts
      '((:name "dict1" :file "/path/to/pyim-dict1.pyim" :coding gbk-dos :dict-type pinyin-dict)
        (:name "dict2" :file "/path/to/pyim-dict2.pyim" :coding gbk-dos :dict-type pinyin-dict)))
</pre>

<p>
注意事项:
</p>
<ol class="org-ol">
<li>必须使用词库文件的绝对路径。</li>
<li>正确设置coding，否则会出现乱码。</li>
</ol>
</div>
</div>


<div id="outline-container-orgd4cae15" class="outline-4">
<h4 id="orgd4cae15"><span class="section-number-4">1.10.7</span> 如何合并两个词库文件</h4>
<div class="outline-text-4" id="text-1-10-7">
<p>
假设有两个词库文件：
</p>

<ol class="org-ol">
<li>file-a.pyim</li>
<li>file-b.pyim</li>
</ol>

<p>
合并方法：
</p>

<ol class="org-ol">
<li><p>
将两个词库文件的内容合并到一起，比如：
</p>
<pre class="example">
cat file-a.pyim file-b.pyim &gt; output.pyim
</pre></li>
<li>使用 emacs 打开合并后的文件：output.pyim</li>
<li>运行 pyim-update-dict-file 命令对 output.pyim 的内容进行排序，然后保存。</li>
</ol>
</div>
</div>

<div id="outline-container-org62ea598" class="outline-4">
<h4 id="org62ea598"><span class="section-number-4">1.10.8</span> 如何快速切换词库</h4>
<div class="outline-text-4" id="text-1-10-8">
<p>
用户可以自定义类似的命令来实现快速切换拼音词库。
</p>

<pre class="example">
(defun pyim-use-dict:bigdict ()
  (interactive)
  (setq pyim-dicts
        '((:name "BigDict"
                 :file "/path/to/pyim-bigdict.pyim.gz"
                 :coding utf-8-unix
                 :dict-type pinyin-dict)))
  (pyim-restart-1 t))
</pre>
</div>
</div>

<div id="outline-container-org8024014" class="outline-4">
<h4 id="org8024014"><span class="section-number-4">1.10.9</span> 将汉字字符串转换为拼音字符串</h4>
<div class="outline-text-4" id="text-1-10-9">
<p>
下面两个函数可以将中文字符串转换的拼音字符串或者列表，用于 emacs-lisp
编程。
</p>

<ol class="org-ol">
<li>`pyim-hanzi2pinyin' （考虑多音字）</li>
<li>`pyim-hanzi2pinyin-simple'  （不考虑多音字）</li>
</ol>
</div>
</div>

<div id="outline-container-org0c7b1a8" class="outline-4">
<h4 id="org0c7b1a8"><span class="section-number-4">1.10.10</span> 中文分词</h4>
<div class="outline-text-4" id="text-1-10-10">
<p>
Chinese-pyim 包含了一个简单的分词函数：`pyim-split-chinese-string'. 这个函数使用暴力匹配模式来分词，所以，<b>不能检测出</b> Chinese-pyim 词库中不存在的中文词条。另外，这个函数的分词速度比较慢，仅仅适用于中文短句的分词，不适用于文章分词。根据评估，20个汉字组成的字符串需要大约0.3s， 40个汉字消耗1s，随着字符串长度的增大消耗的时间呈几何倍数增加。
</p>

<p>
举例来说：
</p>

<pre class="example">
                  (("天安" 5 7)
我爱北京天安门 -&gt;  ("天安门" 5 8)
                   ("北京" 3 5)
                   ("我爱" 1 3))
</pre>

<p>
其中，每一个词条列表中包含三个元素，第一个元素为词条本身，第二个元素为词条相对于字符串的起始位置，第三个元素为词条结束位置。
</p>

<p>
另外一个分词相关的函数是 `pyim-split-chinese-string2string', 这个函数仅仅将一个中文字符串分词，在分词的位置用空格或者用户自定义的分隔符隔开，然后返回新的字符串。
</p>
</div>
</div>

<div id="outline-container-org6241546" class="outline-4">
<h4 id="org6241546"><span class="section-number-4">1.10.11</span> 获取光标处的中文词条</h4>
<div class="outline-text-4" id="text-1-10-11">
<p>
Chinese-pyim 包含了一个简单的命令：`pyim-get-words-list-at-point', 这个命令可以得到光标处的<b>英文</b>或者<b>中文</b>词条的 *列表*，这个命令依赖分词函数：
`pyim-split-chinese-string'。
</p>
</div>
</div>

<div id="outline-container-orgd6bea42" class="outline-4">
<h4 id="orgd6bea42"><span class="section-number-4">1.10.12</span> 让 `forward-word' 和 `back-backward’ 在中文环境下正常工作</h4>
<div class="outline-text-4" id="text-1-10-12">
<p>
中文词语没有强制用空格分词，所以 emacs 内置的命令 `forward-word' 和 `backward-word'
在中文环境不能按用户预期的样子执行，而是 forward/backward “句子” ，Chinese-pyim
自带的两个命令可以在中文环境下正常工作：
</p>

<ol class="org-ol">
<li>`pyim-forward-word</li>
<li>`pyim-backward-word</li>
</ol>

<p>
用户只需将其绑定到快捷键上就可以了，比如：
</p>

<pre class="example">
(global-set-key (kbd "M-f") 'pyim-forward-word)
(global-set-key (kbd "M-b") 'pyim-backward-word)
</pre>
</div>
</div>

<div id="outline-container-orgb6ed0d5" class="outline-4">
<h4 id="orgb6ed0d5"><span class="section-number-4">1.10.13</span> 为 isearch 相关命令添加拼音搜索支持</h4>
<div class="outline-text-4" id="text-1-10-13">
<p>
chinese-pyim 安装后，可以通过下面的设置开启拼音搜索功能：
</p>

<pre class="example">
(setq pyim-isearch-enable-pinyin-search t)
</pre>

<p>
值得注意的是：这个功能有一些限制：搜索字符串中只能出现 “a-z” 和 “’”，如果有其他字符（比如 regexp 操作符），则自动关闭拼音搜索功能。
</p>

<p>
如果用户开启了拼音搜索功能，可以使用下面的方式<b>强制关闭</b> isearch 搜索框中文输入（即使在 Chinese-pyim 激活的时候）。
</p>

<pre class="example">
(setq-default pyim-english-input-switch-functions
              '(pyim-probe-isearch-mode))
</pre>
</div>
</div>



<div id="outline-container-org35d4d7b" class="outline-4">
<h4 id="org35d4d7b"><span class="section-number-4">1.10.14</span> 使用 Chinese-pyim 改善 company-mode 中文补全的体验</h4>
<div class="outline-text-4" id="text-1-10-14">
<p>
中文词语之间没有分割字符，所以 Company-mode 在中文环境下，<b>补全词条</b>变成了<b>补全句子</b>，可用性很差，chinese-pyim-company 通过 Chinese-pyim 自带的分词函数来分割中文字符串，改善了中文补全的体验 。
</p>

<p>
安装和使用方式：
</p>

<ol class="org-ol">
<li>安装配置 `company-mode' 扩展包，具体可以参考：<a href="https://github.com/tumashu/emacs-helper/blob/master/eh-complete.el">emacs-helper's company configure</a></li>
<li><p>
在 emacs 配置中添加如下几行代码：
</p>
<pre class="example">
(require 'chinese-pyim-company)
(setq pyim-company-max-length 6)
</pre></li>
</ol>

<p>
用户也可以通过下面的方式<b>禁用</b> company 中文补全
</p>

<pre class="example">
(setq pyim-company-complete-chinese-enable nil)
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-org5f562dd" class="outline-2">
<h2 id="org5f562dd"><span class="section-number-2">2</span> 代码&#xa0;&#xa0;&#xa0;<span class="tag"><span class="code">code</span></span></h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-pymap</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-core</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-dictools</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-utils</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">chinese-pyim-probe</span>)
</pre>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2016-06-19</span>
        <span title="last modification date" class="post-info">2016-06-19</span>
        <span title="tags" class="post-info">N/A</span>
        <span title="author" class="post-info">Feng Shu</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'tumashu-website'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; <span id="footerYear"></span> <a href="mailto:tumashu &lt;at&gt; 163 &lt;dot&gt; com">Feng Shu</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/tumashu/org-webpage" target="_blank">org-webpage</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

</div>
</body>
</html>
