<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>pyim.el --- A Chinese input method which support quanpin, shuangpin and wubi. - pyim</title>
    <meta charset="utf-8" />
    <meta name="author" content="Feng Shu" />
    <link rel="stylesheet" href="https://tumashu.github.io/pyim/media/css/main.css" type="text/css">
  </head>
<body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="https://tumashu.github.io/pyim/">pyim</a> <span class="subtitle">(一个 emacs 环境下的中文拼音输入法)</span></h1>
        <ul>
          <li><a href="https://tumashu.github.io/pyim/documents/">Documents</a></li>
          <li><a href="https://tumashu.github.io/pyim/snapshots/">Snapshots</a></li>
          <li><a href="https://tumashu.github.io/pyim/tags/">Tags</a></li>
          <li><a href="https://tumashu.github.io/pyim/about/">About</a></li>
          <li><a href="https://github.com/tumashu/pyim">GitHub</a></li>
          <li><a href="https://tumashu.github.io/pyim/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="tumashu.github.io/pyim">
        </form>
        <img class="avatar" src="https://tumashu.github.io/pyim/media/img/horse.jpg" />
      </header>
    </div>

<div class="content-and-footer">
<div>
<div class="post">
<h1 class="post-title">pyim.el --- A Chinese input method which support quanpin, shuangpin and wubi.</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3f1eb5c">1. pyim 使用说明</a>
<ul>
<li><a href="#org030a6ac">1.1. 截图</a></li>
<li><a href="#org74473a9">1.2. 简介</a></li>
<li><a href="#org81fd141">1.3. 背景</a></li>
<li><a href="#org0cc64fd">1.4. 目标</a></li>
<li><a href="#org1ee56d5">1.5. 特点</a></li>
<li><a href="#org0fc2fad">1.6. 安装</a></li>
<li><a href="#orgcf7f100">1.7. 配置</a>
<ul>
<li><a href="#org3d8c29b">1.7.1. 配置实例</a></li>
<li><a href="#orgae34f4b">1.7.2. 添加词库文件</a></li>
<li><a href="#orgcfb6278">1.7.3. 激活 pyim</a></li>
</ul>
</li>
<li><a href="#org994387d">1.8. 使用</a>
<ul>
<li><a href="#org8cdeef6">1.8.1. 常用快捷键</a></li>
<li><a href="#org74d7469">1.8.2. 使用双拼模式</a></li>
<li><a href="#org00f07f5">1.8.3. 使用五笔输入</a></li>
<li><a href="#org21f4f8d">1.8.4. 让选词框跟随光标</a></li>
<li><a href="#orgd3cc891">1.8.5. 调整 tooltip 选词框的显示样式</a></li>
<li><a href="#orge5dbe3a">1.8.6. 设置模糊音</a></li>
<li><a href="#orgf6d6526">1.8.7. 词条获取</a></li>
<li><a href="#org19bebbe">1.8.8. 切换全角标点与半角标点</a></li>
<li><a href="#orgaf9f31b">1.8.9. 手动加词和删词</a></li>
<li><a href="#orgf798e94">1.8.10. pyim 高级功能</a>
<ul>
<li><a href="#org262498c">1.8.10.1. 根据环境自动切换到英文输入模式</a></li>
<li><a href="#org6a2cfa5">1.8.10.2. 根据环境自动切换到半角标点输入模式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org384bf2e">1.9. 捐赠</a></li>
<li><a href="#orgf636d90">1.10. Tips</a>
<ul>
<li><a href="#org1ee4039">1.10.1. 如何将个人词条导出到一个文件</a></li>
<li><a href="#org08766d1">1.10.2. pyim 出现错误时，如何开启 debug 模式</a></li>
<li><a href="#org5ea7ca1">1.10.3. 选词框弹出位置不合理或者选词框内容显示不全</a></li>
<li><a href="#org5c76493">1.10.4. 如何查看 pyim 文档。</a></li>
<li><a href="#org7ca335a">1.10.5. 将光标处的拼音或者五笔字符串转换为中文 (与 vimim 的 “点石成金” 功能类似)</a></li>
<li><a href="#org51737b5">1.10.6. 如何添加自定义拼音词库</a>
<ul>
<li><a href="#org3592f1f">1.10.6.1. 第一种方式 (懒人推荐使用)</a></li>
<li><a href="#org6d270fb">1.10.6.2. 第二种方式 (Windows 用户推荐使用)</a></li>
<li><a href="#org8331535">1.10.6.3. 第三种方式 (Linux &amp; Unix 用户推荐使用)</a></li>
</ul>
</li>
<li><a href="#org6875399">1.10.7. 如何手动安装和管理词库</a></li>
<li><a href="#orga40072d">1.10.8. Emacs 启动时加载 pyim 词库</a></li>
<li><a href="#org746ec42">1.10.9. 将汉字字符串转换为拼音字符串</a></li>
<li><a href="#orgc8f526c">1.10.10. 中文分词</a></li>
<li><a href="#orgd1e8f75">1.10.11. 获取光标处的中文词条</a></li>
<li><a href="#org7d3fce4">1.10.12. 让 `forward-word' 和 `back-backward’ 在中文环境下正常工作</a></li>
<li><a href="#org5eab579">1.10.13. 为 isearch 相关命令添加拼音搜索支持</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org3f1eb5c" class="outline-2">
<h2 id="org3f1eb5c"><span class="section-number-2">1</span> pyim 使用说明</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-org030a6ac" class="outline-3">
<h3 id="org030a6ac"><span class="section-number-3">1.1</span> 截图</h3>
<div class="outline-text-3" id="text-1-1">

<div class="figure">
<p><img src="https://tumashu.github.io/pyim/assets/pyim-linux-x-with-toolkit.png" alt="pyim-linux-x-with-toolkit.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org74473a9" class="outline-3">
<h3 id="org74473a9"><span class="section-number-3">1.2</span> 简介</h3>
<div class="outline-text-3" id="text-1-2">
<p>
pyim 是 Emacs 环境下的一个中文输入法，最初它只支持全拼输入，所以当时
"pyim" 代表 "Chinese Pinyin Input Method" 的意思，后来根据同学的提议，添加了五笔的支持，再叫 “拼音输入法” 就不太合适了，所以你现在可以将它理解为 “PengYou input method”： 平时像朋友一样帮助你，偶尔也像朋友一样犯二 。。。
</p>
</div>
</div>

<div id="outline-container-org81fd141" class="outline-3">
<h3 id="org81fd141"><span class="section-number-3">1.3</span> 背景</h3>
<div class="outline-text-3" id="text-1-3">
<p>
pyim 的代码源自 emacs-eim。
</p>

<p>
emacs-eim 是 Emacs 环境下的一个中文输入法框架， 支持拼音，五笔，仓颉以及二笔等多种输入法，但遗憾的是，2008 年之后它就停止了开发，我认为主要原因是外部中文输入法快速发展。
</p>

<p>
虽然外部输入法功能强大，但不能和 Emacs 默契的配合，这一点极大的损害了 Emacs 那种<b>行云流水</b>
的感觉。而本人在使用（或者叫折腾） emacs-eim 的过程中发现：
</p>

<ol class="org-ol">
<li><b>当 emacs-eim 词库词条超过 100 万时，选词频率大大降低，中文体验增强。</b></li>
<li><b>随着使用时间的延长，emacs-eim 会越来越好用（个人词库的积累）。</b></li>
</ol>

<p>
于是我 fork 了 emacs-eim 输入法的部分代码, 创建了一个项目：pyim。
</p>
</div>
</div>

<div id="outline-container-org0cc64fd" class="outline-3">
<h3 id="org0cc64fd"><span class="section-number-3">1.4</span> 目标</h3>
<div class="outline-text-3" id="text-1-4">
<p>
pyim 的目标是：<b>尽最大的努力成为一个好用的 Emacs 中文输入法</b>，具体可表现为三个方面：
</p>

<ol class="org-ol">
<li>Fallback:     当外部输入法不能使用时，比如在 console 或者 cygwin 环境下，尽最大可能让 Emacs 用户不必为输入中文而烦恼。</li>
<li>Integration:  尽最大可能减少输入法切换频率，让中文输入不影响 Emacs
的体验。</li>
<li>Exchange:     尽最大可能简化 pyim 使用其他优秀输入法的词库的难度和复杂度。</li>
</ol>
</div>
</div>

<div id="outline-container-org1ee56d5" class="outline-3">
<h3 id="org1ee56d5"><span class="section-number-3">1.5</span> 特点</h3>
<div class="outline-text-3" id="text-1-5">
<ol class="org-ol">
<li>pyim 支持全拼，双拼和五笔，其中对全拼的支持最好。</li>
<li>pyim 通过添加词库的方式优化输入法。</li>
<li>pyim 使用文本词库格式，方便处理。</li>
</ol>
</div>
</div>

<div id="outline-container-org0fc2fad" class="outline-3">
<h3 id="org0fc2fad"><span class="section-number-3">1.6</span> 安装</h3>
<div class="outline-text-3" id="text-1-6">
<ol class="org-ol">
<li>配置 melpa 源，参考：<a href="http://melpa.org/#/getting-started">http://melpa.org/#/getting-started</a></li>
<li>M-x package-install RET pyim RET</li>
<li><p>
在 Emacs 配置文件中（比如: ~/.emacs）添加如下代码：
</p>
<pre class="example">
(require 'pyim)
(require 'pyim-basedict) ; 拼音词库设置，五笔用户 *不需要* 此行设置
(pyim-basedict-enable)   ; 拼音词库，五笔用户 *不需要* 此行设置
(setq default-input-method "pyim")
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-orgcf7f100" class="outline-3">
<h3 id="orgcf7f100"><span class="section-number-3">1.7</span> 配置</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-org3d8c29b" class="outline-4">
<h4 id="org3d8c29b"><span class="section-number-4">1.7.1</span> 配置实例</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
对 pyim 感兴趣的同学，可以看看本人的 pyim 配置（总是适用于最新版的 pyim）:
</p>

<pre class="example">
(use-package pyim
  :ensure nil
  :config
  ;; 激活 basedict 拼音词库
  (use-package pyim-basedict
    :ensure nil
    :config (pyim-basedict-enable))

  ;; 五笔用户使用 wbdict 词库
  ;; (use-package pyim-wbdict
  ;;   :ensure nil
  ;;   :config (pyim-wbdict-gbk-enable))

  (setq default-input-method "pyim")

  ;; 我使用全拼
  (setq pyim-default-scheme 'quanpin)

  ;; 设置 pyim 探针设置，这是 pyim 高级功能设置，可以实现 *无痛* 中英文切换 :-)
  ;; 我自己使用的中英文动态切换规则是：
  ;; 1. 光标只有在注释里面时，才可以输入中文。
  ;; 2. 光标前是汉字字符时，才能输入中文。
  ;; 3. 使用 M-j 快捷键，强制将光标前的拼音字符串转换为中文。
  (setq-default pyim-english-input-switch-functions
                '(pyim-probe-dynamic-english
                  pyim-probe-isearch-mode
                  pyim-probe-program-mode
                  pyim-probe-org-structure-template))

  (setq-default pyim-punctuation-half-width-functions
                '(pyim-probe-punctuation-line-beginning
                  pyim-probe-punctuation-after-punctuation))

  ;; 开启拼音搜索功能
  (setq pyim-isearch-enable-pinyin-search t)

  ;; 使用 pupup-el 来绘制选词框
  (setq pyim-page-tooltip 'popup)

  ;; 选词框显示5个候选词
  (setq pyim-page-length 5)

  ;; 让 Emacs 启动时自动加载 pyim 词库
  (add-hook 'emacs-startup-hook
            #'(lambda () (pyim-restart-1 t)))
  :bind
  (("M-j" . pyim-convert-code-at-point) ;与 pyim-probe-dynamic-english 配合
   ("C-;" . pyim-delete-word-from-personal-buffer)))
</pre>
</div>
</div>

<div id="outline-container-orgae34f4b" class="outline-4">
<h4 id="orgae34f4b"><span class="section-number-4">1.7.2</span> 添加词库文件</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
pyim 当前的默认的拼音词库是 pyim-basedict, 这个词库的词条量
8 万左右，是一个<b>非常小</b>的拼音词库，词条的来源有两个：
</p>

<ol class="org-ol">
<li>libpinyin 项目的内置词库</li>
<li>pyim 用户贡献的个人词库</li>
</ol>

<p>
注意： 这个词库只能确保 pyim 可以正常工作，如果用户想让
pyim 更加顺手，需要添加附加的词库，一个比较好的选择是安装
pyim-greatdict:
</p>

<p>
<a href="https://github.com/tumashu/pyim-greatdict">https://github.com/tumashu/pyim-greatdict</a>
</p>

<p>
pyim-greatdict 包对应的词库由 <a href="https://github.com/xiaowl">WenLiang Xiao</a> 同学开发制作，词条有 300 万条，词库文件大约 80M, 是一个<b>大而全</b>的词库，用户可以通过 Melpa 来安装它：
</p>

<ol class="org-ol">
<li>配置melpa源，参考：<a href="http://melpa.org/#/getting-started">http://melpa.org/#/getting-started</a></li>
<li>M-x package-install RET pyim-greatdict RET</li>
<li><p>
在emacs配置文件中（比如: ~/.emacs）添加如下代码：
</p>

<pre class="example">
(require 'pyim-greatdict)
(pyim-greatdict-enable)
</pre></li>
</ol>

<p>
但值得注意的是：
</p>

<ol class="org-ol">
<li>如果机器性能不好，安装 pyim-greatdict 会导致 pyim 启动非常缓慢，请仔细考虑。</li>
<li>这个词库使用 gzip 压缩，非 Linux 用户需要安装 <a href="http://www.gzip.org/">gzip</a> 程序，并配置好系统 PATH 。</li>
</ol>

<p>
如果 pyim-greatdict 不能满足需求，用户可以使用其他方式为 pyim 添加拼音词库，具体方式请参考 <a href="#org51737b5">1.10.6</a> 小结。
</p>
</div>
</div>

<div id="outline-container-orgcfb6278" class="outline-4">
<h4 id="orgcfb6278"><span class="section-number-4">1.7.3</span> 激活 pyim</h4>
<div class="outline-text-4" id="text-1-7-3">
<pre class="example">
(setq default-input-method "pyim")
(global-set-key (kbd "C-\\") 'toggle-input-method)
</pre>
</div>
</div>
</div>

<div id="outline-container-org994387d" class="outline-3">
<h3 id="org994387d"><span class="section-number-3">1.8</span> 使用</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-org8cdeef6" class="outline-4">
<h4 id="org8cdeef6"><span class="section-number-4">1.8.1</span> 常用快捷键</h4>
<div class="outline-text-4" id="text-1-8-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">输入法快捷键</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-n 或 M-n 或 +</td>
<td class="org-left">向下翻页</td>
</tr>

<tr>
<td class="org-left">C-p 或 M-p 或 -</td>
<td class="org-left">向上翻页</td>
</tr>

<tr>
<td class="org-left">C-f</td>
<td class="org-left">选择下一个备选词</td>
</tr>

<tr>
<td class="org-left">C-b</td>
<td class="org-left">选择上一个备选词</td>
</tr>

<tr>
<td class="org-left">SPC</td>
<td class="org-left">确定输入</td>
</tr>

<tr>
<td class="org-left">RET 或 C-m</td>
<td class="org-left">字母上屏</td>
</tr>

<tr>
<td class="org-left">C-c</td>
<td class="org-left">取消输入</td>
</tr>

<tr>
<td class="org-left">C-g</td>
<td class="org-left">取消输入并保留已输入的中文</td>
</tr>

<tr>
<td class="org-left">TAB</td>
<td class="org-left">模糊音调整</td>
</tr>

<tr>
<td class="org-left">DEL 或 BACKSPACE</td>
<td class="org-left">删除最后一个字符</td>
</tr>

<tr>
<td class="org-left">C-DEL 或  C-BACKSPACE</td>
<td class="org-left">删除最后一个拼音</td>
</tr>

<tr>
<td class="org-left">M-DEL 或  M-BACKSPACE</td>
<td class="org-left">删除最后一个拼音</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org74d7469" class="outline-4">
<h4 id="org74d7469"><span class="section-number-4">1.8.2</span> 使用双拼模式</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
pyim 支持双拼输入模式，用户可以通过变量 `pyim-default-scheme' 来设定：
</p>

<pre class="example">
(setq pyim-default-scheme 'pyim-shuangpin)
</pre>

<p>
注意：
</p>
<ol class="org-ol">
<li>pyim 支持微软双拼（microsoft-shuangpin）和小鹤双拼（xiaohe-shuangpin）。</li>
<li>用户可以使用变量 `pyim-schemes' 添加自定义双拼方案。</li>
<li>用户可能需要重新设置 `pyim-translate-trigger-char'。</li>
</ol>
</div>
</div>

<div id="outline-container-org00f07f5" class="outline-4">
<h4 id="org00f07f5"><span class="section-number-4">1.8.3</span> 使用五笔输入</h4>
<div class="outline-text-4" id="text-1-8-3">
<p>
pyim 支持五笔输入模式，用户可以通过变量 `pyim-default-scheme' 来设定：
</p>

<pre class="example">
(setq pyim-default-scheme 'wubi)
</pre>

<p>
在使用五笔输入法之前，请用 pyim-dicts-manager 添加一个五笔词库，词库的格式类似：
</p>

<pre class="example">
# ;;; -*- coding: utf-8-unix -*-
.aaaa 工
.aad 式
.aadk 匿
.aadn 慝 葚
.aadw 萁
.aafd 甙
.aaff 苷
.aaht 芽
.aak 戒
</pre>

<p>
最简单的方式是从 melpa 中安装 pyim-wbdict 包，然后根据它的
<a href="https://github.com/tumashu/pyim-wbdict">README</a> 来配置。
</p>

<p>
注意：为了简化代码和提高输入法响应速度，pyim 直接将拼音词库和五笔词库合并到同一个dcache 文件中，所以 pyim <b>强制规定</b>在词库中，五笔编码<b>必须</b>都以 '.' 开头，比如 '.aaaa' ,这样可以避免出现不必要的混乱。
</p>

<p>
用户可以使用命令：`pyim-search-word-code' 来查询当前选择词条的五笔编码。
</p>
</div>
</div>

<div id="outline-container-org21f4f8d" class="outline-4">
<h4 id="org21f4f8d"><span class="section-number-4">1.8.4</span> 让选词框跟随光标</h4>
<div class="outline-text-4" id="text-1-8-4">
<p>
用户可以通过下面的设置让 pyim 在<b>光标处</b>显示一个选词框：
</p>

<ol class="org-ol">
<li><p>
使用 popup 包来绘制选词框 （emacs overlay 机制）
</p>
<pre class="example">
(setq pyim-page-tooltip 'popup)
</pre></li>
<li><p>
使用 pos-tip 包来绘制选词框（emacs tooltip 机制）
</p>
<pre class="example">
(setq pyim-page-tooltip 'pos-tip)
</pre></li>
</ol>

<p>
注：Linux 平台下，emacs 可以使用 GTK 来绘制选词框：
</p>

<pre class="example">
(setq pyim-page-tooltip 'pos-tip)
(setq x-gtk-use-system-tooltips t)
</pre>

<p>
GTK 选词框的字体设置可以参考：<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/GTK-resources.html#GTK-resources">GTK resources</a> 。
</p>
</div>
</div>

<div id="outline-container-orgd3cc891" class="outline-4">
<h4 id="orgd3cc891"><span class="section-number-4">1.8.5</span> 调整 tooltip 选词框的显示样式</h4>
<div class="outline-text-4" id="text-1-8-5">
<p>
pyim 的 tooltip 选词框默认使用<b>双行显示</b>的样式，在一些特殊的情况下（比如：popup 显示的菜单错位），用户可以使用<b>单行显示</b>
的样式：
</p>

<pre class="example">
(setq pyim-page-style 'one-line)
</pre>

<p>
注：用户可以添加函数 pyim-page-style:style-name 来定义自己的选词框格式。
</p>
</div>
</div>

<div id="outline-container-orge5dbe3a" class="outline-4">
<h4 id="orge5dbe3a"><span class="section-number-4">1.8.6</span> 设置模糊音</h4>
<div class="outline-text-4" id="text-1-8-6">
<p>
可以通过设置 `pyim-fuzzy-pinyin-alist' 变量来自定义模糊音。
</p>
</div>
</div>

<div id="outline-container-orgf6d6526" class="outline-4">
<h4 id="orgf6d6526"><span class="section-number-4">1.8.7</span> 词条获取</h4>
<div class="outline-text-4" id="text-1-8-7">
<p>
pyim <b>内置</b>了多种词条获取的方式：
</p>

<ol class="org-ol">
<li>`dcache-personal'     从 `pyim-dcache-icode2word' 中获取词条。</li>
<li>`dcache-common'       从 `pyim-dcache-code2word' 中获取词条。</li>
<li>`pinyin-chars'        逐一获取一个拼音对应的多个汉字。</li>
<li>`pinyin-shortcode'    获取一个简拼对应的词条，如果输入 \"ni-hao\" ，那么同时搜索 code 为 \"n-h\" 的词条。</li>
<li>`pinyin-znabc'        类似智能ABC的词语获取方式(源于 emacs-eim)."</li>
</ol>

<p>
用户可以通过下面的代码来调整 backends 设置，比如：
</p>

<pre class="example">
(setq pyim-backends '(dcache-personal dcache-common pinyin-chars pinyin-shortcode pinyin-znabc))
</pre>

<p>
一些 backends 可能会导致输入法卡顿，用户可以通过下面的方式关闭：
</p>

<pre class="example">
(setq pyim-backends '(dcache-personal dcache-common pinyin-chars))
</pre>
</div>
</div>

<div id="outline-container-org19bebbe" class="outline-4">
<h4 id="org19bebbe"><span class="section-number-4">1.8.8</span> 切换全角标点与半角标点</h4>
<div class="outline-text-4" id="text-1-8-8">
<ol class="org-ol">
<li>第一种方法：使用命令 `pyim-punctuation-toggle'，全局切换。</li>
<li>第二种方法：使用命令 `pyim-punctuation-translate-at-point' 只切换光标处标点的样式。</li>
<li>第三种方法：设置变量 `pyim-translate-trigger-char' ，输入变量设定的字符会切换光标处标点的样式。</li>
</ol>
</div>
</div>

<div id="outline-container-orgaf9f31b" class="outline-4">
<h4 id="orgaf9f31b"><span class="section-number-4">1.8.9</span> 手动加词和删词</h4>
<div class="outline-text-4" id="text-1-8-9">
<ol class="org-ol">
<li>`pyim-create-word-at-point:"N"char' 这是一组命令，从光标前提取N个汉字字符组成字符串，并将其加入个人词库。</li>
<li>`pyim-translate-trigger-char' 以默认设置为例：在“我爱吃红烧肉”后输入“5v” 可以将“爱吃红烧肉”这个词条保存到用户个人词库。</li>
<li>`pyim-create-word-from-selection', 选择一个词条，运行这个命令后，就可以将这个词条添加到个人词库。</li>
<li>`pyim-delete-word' 从个人词库中删除当前高亮选择的词条。</li>
</ol>
</div>
</div>

<div id="outline-container-orgf798e94" class="outline-4">
<h4 id="orgf798e94"><span class="section-number-4">1.8.10</span> pyim 高级功能</h4>
<div class="outline-text-4" id="text-1-8-10">
<ol class="org-ol">
<li>根据环境自动切换到英文输入模式，使用 pyim-english-input-switch-functions 配置。</li>
<li>根据环境自动切换到半角标点输入模式，使用 pyim-punctuation-half-width-functions 配置。</li>
</ol>

<p>
注意：上述两个功能使用不同的变量设置，<b>千万不要搞错</b>。
</p>
</div>

<div id="outline-container-org262498c" class="outline-5">
<h5 id="org262498c"><span class="section-number-5">1.8.10.1</span> 根据环境自动切换到英文输入模式</h5>
<div class="outline-text-5" id="text-1-8-10-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">探针函数</th>
<th scope="col" class="org-left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pyim-probe-program-mode</td>
<td class="org-left">如果当前的 mode 衍生自 prog-mode，那么仅仅在字符串和 comment 中开启中文输入模式</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-org-speed-commands</td>
<td class="org-left">解决 org-speed-commands 与 pyim 冲突问题</td>
</tr>

<tr>
<td class="org-left">pyim-probe-isearch-mode</td>
<td class="org-left">使用 isearch 搜索时，强制开启英文输入模式</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">注意：想要使用这个功能，pyim-isearch-enable-pinyin-search 必须设置为 t</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-org-structure-template</td>
<td class="org-left">使用 org-structure-template 时，关闭中文输入模式</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">1. 当前字符为中文字符时，输入下一个字符时默认开启中文输入</td>
</tr>

<tr>
<td class="org-left">pyim-probe-dynamic-english</td>
<td class="org-left">2. 当前字符为其他字符时，输入下一个字符时默认开启英文输入</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">3. 使用命令 pyim-convert-code-at-point 可以将光标前的拼音字符串强制转换为中文。</td>
</tr>
</tbody>
</table>

<p>
激活方式：
</p>

<pre class="example">
(setq-default pyim-english-input-switch-functions
              '(probe-function1 probe-function2 probe-function3))
</pre>

<p>
注：上述函数列表中，任意一个函数的返回值为 t 时，pyim 切换到英文输入模式。
</p>
</div>
</div>

<div id="outline-container-org6a2cfa5" class="outline-5">
<h5 id="org6a2cfa5"><span class="section-number-5">1.8.10.2</span> 根据环境自动切换到半角标点输入模式</h5>
<div class="outline-text-5" id="text-1-8-10-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">探针函数</th>
<th scope="col" class="org-left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pyim-probe-punctuation-line-beginning</td>
<td class="org-left">行首强制输入半角标点</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">pyim-probe-punctuation-after-punctuation</td>
<td class="org-left">半角标点后强制输入半角标点</td>
</tr>
</tbody>
</table>

<p>
激活方式：
</p>

<pre class="example">
(setq-default pyim-punctuation-half-width-functions
              '(probe-function4 probe-function5 probe-function6))
</pre>

<p>
注：上述函数列表中，任意一个函数的返回值为 t 时，pyim 切换到半角标点输入模式。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org384bf2e" class="outline-3">
<h3 id="org384bf2e"><span class="section-number-3">1.9</span> 捐赠</h3>
<div class="outline-text-3" id="text-1-9">
<p>
您可以通过小额捐赠的方式支持 pyim 的开发工作，具体方式：
</p>

<ol class="org-ol">
<li>通过支付宝收款账户：tumashu@163.com</li>
<li><p>
通过支付宝钱包扫描：
</p>


<div class="figure">
<p><img src="https://tumashu.github.io/pyim/assets/QR-code-for-author.jpg" alt="QR-code-for-author.jpg" />
</p>
</div></li>
</ol>
</div>
</div>


<div id="outline-container-orgf636d90" class="outline-3">
<h3 id="orgf636d90"><span class="section-number-3">1.10</span> Tips</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-org1ee4039" class="outline-4">
<h4 id="org1ee4039"><span class="section-number-4">1.10.1</span> 如何将个人词条导出到一个文件</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
使用命令：pyim-personal-dcache-export
</p>
</div>
</div>

<div id="outline-container-org08766d1" class="outline-4">
<h4 id="org08766d1"><span class="section-number-4">1.10.2</span> pyim 出现错误时，如何开启 debug 模式</h4>
<div class="outline-text-4" id="text-1-10-2">
<pre class="example">
(setq debug-on-error t)
</pre>
</div>
</div>

<div id="outline-container-org5ea7ca1" class="outline-4">
<h4 id="org5ea7ca1"><span class="section-number-4">1.10.3</span> 选词框弹出位置不合理或者选词框内容显示不全</h4>
<div class="outline-text-4" id="text-1-10-3">
<p>
可以通过设置 `pyim-tooltip-width-adjustment' 变量来手动校正。
</p>

<ol class="org-ol">
<li>选词框内容显示不全：增大变量值</li>
<li>选词框弹出位置不合理：减小变量值</li>
</ol>
</div>
</div>

<div id="outline-container-org5c76493" class="outline-4">
<h4 id="org5c76493"><span class="section-number-4">1.10.4</span> 如何查看 pyim 文档。</h4>
<div class="outline-text-4" id="text-1-10-4">
<p>
pyim 的文档隐藏在 comment 中，如果用户喜欢阅读 html 格式的文档，可以查看在线文档；
</p>

<p>
<a href="http://tumashu.github.io/pyim/">http://tumashu.github.io/pyim/</a>
</p>
</div>
</div>

<div id="outline-container-org7ca335a" class="outline-4">
<h4 id="org7ca335a"><span class="section-number-4">1.10.5</span> 将光标处的拼音或者五笔字符串转换为中文 (与 vimim 的 “点石成金” 功能类似)</h4>
<div class="outline-text-4" id="text-1-10-5">
<pre class="example">
(global-set-key (kbd "M-i") 'pyim-convert-code-at-point)
</pre>
</div>
</div>

<div id="outline-container-org51737b5" class="outline-4">
<h4 id="org51737b5"><span class="section-number-4">1.10.6</span> 如何添加自定义拼音词库</h4>
<div class="outline-text-4" id="text-1-10-6">
<p>
pyim 默认没有携带任何拼音词库，用户可以使用下面几种方式，获取质量较好的拼音词库：
</p>
</div>

<div id="outline-container-org3592f1f" class="outline-5">
<h5 id="org3592f1f"><span class="section-number-5">1.10.6.1</span> 第一种方式 (懒人推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-6-1">
<p>
获取其他 pyim 用户的拼音词库，比如，某个同学测试 pyim
时创建了一个中文拼音词库，词条数量大约60万。
</p>

<p>
<a href="http://tumashu.github.io/pyim-bigdict/pyim-bigdict.pyim.gz">http://tumashu.github.io/pyim-bigdict/pyim-bigdict.pyim.gz</a>
</p>

<p>
下载上述词库后，运行 `pyim-dicts-manager' ，按照命令提示，将下载得到的词库文件信息添加到 `pyim-dicts' 中，最后运行命令 `pyim-restart' 或者重启
emacs，这个词库使用 `utf-8-unix' 编码。
</p>
</div>
</div>

<div id="outline-container-org6d270fb" class="outline-5">
<h5 id="org6d270fb"><span class="section-number-5">1.10.6.2</span> 第二种方式 (Windows 用户推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-6-2">
<p>
使用词库转换工具将其他输入法的词库转化为pyim使用的词库：这里只介绍windows平台下的一个词库转换软件：
</p>

<ol class="org-ol">
<li>软件名称： imewlconverter</li>
<li>中文名称： 深蓝词库转换</li>
<li>下载地址： <a href="https://github.com/studyzy/imewlconverter">https://github.com/studyzy/imewlconverter</a></li>
<li>依赖平台： Microsoft .NET Framework (&gt;= 3.5)</li>
</ol>

<p>
使用方式：
</p>


<div class="figure">
<p><img src="https://tumashu.github.io/pyim/assets/imewlconverter-basic.gif" alt="imewlconverter-basic.gif" />
</p>
</div>

<p>
如果生成的词库词频不合理，可以按照下面的方式处理（非常有用的功能）：
</p>


<div class="figure">
<p><img src="https://tumashu.github.io/pyim/assets/imewlconverter-wordfreq.gif" alt="imewlconverter-wordfreq.gif" />
</p>
</div>

<p>
生成词库后，运行 `pyim-dicts-manager' ，按照命令提示，将转换得到的词库文件的信息添加到 `pyim-dicts' 中，完成后运行命令 `pyim-restart' 或者重启emacs。
</p>
</div>
</div>

<div id="outline-container-org8331535" class="outline-5">
<h5 id="org8331535"><span class="section-number-5">1.10.6.3</span> 第三种方式 (Linux &amp; Unix 用户推荐使用)</h5>
<div class="outline-text-5" id="text-1-10-6-3">
<p>
E-Neo 同学编写了一个词库转换工具: <a href="https://github.com/E-Neo/scel2pyim">scel2pyim</a> ,
可以将一个搜狗词库转换为 pyim 词库。
</p>

<ol class="org-ol">
<li>软件名称： scel2pyim</li>
<li>下载地址： <a href="https://github.com/E-Neo/scel2pyim">https://github.com/E-Neo/scel2pyim</a></li>
<li>编写语言： C语言</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org6875399" class="outline-4">
<h4 id="org6875399"><span class="section-number-4">1.10.7</span> 如何手动安装和管理词库</h4>
<div class="outline-text-4" id="text-1-10-7">
<p>
这里假设有两个词库文件：
</p>

<ol class="org-ol">
<li>/path/to/pyim-dict1.pyim</li>
<li>/path/to/pyim-dict2.pyim</li>
</ol>

<p>
在~/.emacs文件中添加如下一行配置。
</p>

<pre class="example">
(setq pyim-dicts
      '((:name "dict1" :file "/path/to/pyim-dict1.pyim")
        (:name "dict2" :file "/path/to/pyim-dict2.pyim")))
</pre>

<p>
注意事项:
</p>
<ol class="org-ol">
<li>只有 :file 是<b>必须</b>设置的。</li>
<li>必须使用词库文件的绝对路径。</li>
<li>词库文件的编码必须为 utf-8-unix，否则会出现乱码。</li>
</ol>
</div>
</div>

<div id="outline-container-orga40072d" class="outline-4">
<h4 id="orga40072d"><span class="section-number-4">1.10.8</span> Emacs 启动时加载 pyim 词库</h4>
<div class="outline-text-4" id="text-1-10-8">
<pre class="example">
(add-hook 'emacs-startup-hook
          #'(lambda () (pyim-restart-1 t)))
</pre>
</div>
</div>

<div id="outline-container-org746ec42" class="outline-4">
<h4 id="org746ec42"><span class="section-number-4">1.10.9</span> 将汉字字符串转换为拼音字符串</h4>
<div class="outline-text-4" id="text-1-10-9">
<p>
下面两个函数可以将中文字符串转换的拼音字符串或者列表，用于 emacs-lisp
编程。
</p>

<ol class="org-ol">
<li>`pyim-hanzi2pinyin' （考虑多音字）</li>
<li>`pyim-hanzi2pinyin-simple'  （不考虑多音字）</li>
</ol>
</div>
</div>

<div id="outline-container-orgc8f526c" class="outline-4">
<h4 id="orgc8f526c"><span class="section-number-4">1.10.10</span> 中文分词</h4>
<div class="outline-text-4" id="text-1-10-10">
<p>
pyim 包含了一个简单的分词函数：`pyim-cstring-split-to-list', 可以将一个中文字符串分成一个词条列表，比如：
</p>

<pre class="example">
                  (("天安" 5 7)
我爱北京天安门 -&gt;  ("天安门" 5 8)
                   ("北京" 3 5)
                   ("我爱" 1 3))
</pre>

<p>
其中，每一个词条列表中包含三个元素，第一个元素为词条本身，第二个元素为词条相对于字符串的起始位置，第三个元素为词条结束位置。
</p>

<p>
另一个分词函数是 `pyim-cstring-split-to-string', 这个函数将生成一个新的字符串，在这个字符串中，词语之间用空格或者用户自定义的分隔符隔开。
</p>

<p>
注意，上述两个分词函数使用暴力匹配模式来分词，所以，<b>不能检测出</b> pyim
词库中不存在的中文词条。
</p>
</div>
</div>

<div id="outline-container-orgd1e8f75" class="outline-4">
<h4 id="orgd1e8f75"><span class="section-number-4">1.10.11</span> 获取光标处的中文词条</h4>
<div class="outline-text-4" id="text-1-10-11">
<p>
pyim 包含了一个简单的命令：`pyim-cwords-at-point', 这个命令可以得到光标处的<b>英文</b>或者<b>中文</b>词条的 *列表*，这个命令依赖分词函数：
`pyim-cstring-split-to-list'。
</p>
</div>
</div>

<div id="outline-container-org7d3fce4" class="outline-4">
<h4 id="org7d3fce4"><span class="section-number-4">1.10.12</span> 让 `forward-word' 和 `back-backward’ 在中文环境下正常工作</h4>
<div class="outline-text-4" id="text-1-10-12">
<p>
中文词语没有强制用空格分词，所以 Emacs 内置的命令 `forward-word' 和 `backward-word'
在中文环境不能按用户预期的样子执行，而是 forward/backward “句子” ，pyim
自带的两个命令可以在中文环境下正常工作：
</p>

<ol class="org-ol">
<li>`pyim-forward-word</li>
<li>`pyim-backward-word</li>
</ol>

<p>
用户只需将其绑定到快捷键上就可以了，比如：
</p>

<pre class="example">
(global-set-key (kbd "M-f") 'pyim-forward-word)
(global-set-key (kbd "M-b") 'pyim-backward-word)
</pre>
</div>
</div>

<div id="outline-container-org5eab579" class="outline-4">
<h4 id="org5eab579"><span class="section-number-4">1.10.13</span> 为 isearch 相关命令添加拼音搜索支持</h4>
<div class="outline-text-4" id="text-1-10-13">
<p>
pyim 安装后，可以通过下面的设置开启拼音搜索功能：
</p>

<pre class="example">
(setq pyim-isearch-enable-pinyin-search t)
</pre>

<p>
值得注意的是：这个功能有一些限制：搜索字符串中只能出现 “a-z” 和 “’”，如果有其他字符（比如 regexp 操作符），则自动关闭拼音搜索功能。
</p>

<p>
如果用户开启了拼音搜索功能，可以使用下面的方式<b>强制关闭</b> isearch 搜索框中文输入（即使在 pyim 激活的时候）。
</p>

<pre class="example">
(setq-default pyim-english-input-switch-functions
              '(pyim-probe-isearch-mode))
</pre>
</div>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; <span id="footerYear"></span> <a href="mailto:tumashu &lt;at&gt; 163 &lt;dot&gt; com">Feng Shu</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/tumashu/org-webpage" target="_blank">org-webpage</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

</div>
</body>
</html>
